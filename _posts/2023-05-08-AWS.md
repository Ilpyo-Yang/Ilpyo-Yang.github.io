---
title: AWS
author: Rosie Yang
date: 2023-05-08T00:00:00.000Z
category: devops
---

# AWS

### AWS ë‹¤ì–‘í•œ ë°°í¬ ë°©ë²•ë“¤

#### 1. Github Actionì„ ì‚¬ìš©í•˜ëŠ” ë¬´ì¤‘ë‹¨ ë°°í¬

ìˆ˜ë™ ë°°í¬ ë§ê³  ìë™ ë¹Œë“œë¥¼ ìœ„í•œ Github Actionê³¼ CI, CDê°€ ê°€ëŠ¥í•˜ë„ë¡ ë°°í¬ë¥¼ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.\
CI & CDë€?\
CI/CDëŠ” ê°œë°œìë“¤ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë”ìš± ë¹ ë¥´ê²Œ ê°œë°œí•˜ê³  ë°°í¬í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. CIëŠ” ì½”ë“œ ë³€ê²½ ì‚¬í•­ì„ ì§€ì†ì ìœ¼ë¡œ í†µí•©í•˜ê³  ë¹Œë“œí•˜ë©°, CDëŠ” ì§€ì†ì ìœ¼ë¡œ ë°°í¬í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê°œë°œìëŠ” ë”ìš± ë¹ ë¥¸ í”¼ë“œë°±ì„ ë°›ê³ , ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í’ˆì§ˆì„ ìœ ì§€ ë° ê°œì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

\


![Group 50.png](../assets/gitbook/post\_images/aws/Group%2050.png)

\


**Github Action ì„¤ì •**\
ìë™ ë¹Œë“œë¥¼ ìœ„í•œ Github Actionì„ CI/CD íˆ´ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤. ì´ë¯¸ ë²„ì „ê´€ë¦¬ê°€ Githubìœ¼ë¡œ ë˜ì–´ ìˆê³ , TravisëŠ” ì¼ë¶€ ìœ ë£Œë²„ì „ìœ¼ë¡œ ë³€ê²½ë˜ë©´ì„œ ì ‘ê·¼ì´ ì•ˆë˜ëŠ” ë¶€ë¶„ì´ ìˆì—ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.\
Actions íƒ­ì—ì„œ êµ¬ë™ì„ ìœ„í•œ `.yml`ì„ ì‘ì„±í•˜ë©´ `.github/workflows` ìœ„ì¹˜ì— íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ë¹Œë“œê°€ ì„±ê³µì ìœ¼ë¡œ ë˜ëŠ”ì§€ê¹Œì§€ í™•ì¸í•©ë‹ˆë‹¤.\
í˜„ì¬ëŠ” `--exclude-task test`ë¡œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ì‹œì—ë„ ë¹Œë“œê°€ ê°€ëŠ¥í•˜ê²Œ í•´ë†“ì€ ìƒíƒœì…ë‹ˆë‹¤.

```yml
name: BoardApi CI/CD 

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

permissions:
  contents: read

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'
    - name: Grant execute permission for gradlew
      run: chmod +x gradlew
    - name: Build with Gradle
      run : ./gradlew clean build --exclude-task test
```

ê·¸ë¦¬ê³  AWS ì‚¬ìš©ì„ ìœ„í•´ AWS ACCESS KEY ID, SECRET KEYë¥¼ í•´ë‹¹ ë ˆí¬ ì„¤ì • `Actions secrets and variables`ì— ë“±ë¡í•©ë‹ˆë‹¤.

Jenkins, Travisì™€ì˜ ì°¨ì´ì 

* **GitHub Actions**ëŠ” GitHubì™€ í•¨ê»˜ ì œê³µë˜ëŠ” ë‚´ì¥í˜• CI/CD ë„êµ¬ì…ë‹ˆë‹¤. ì„¤ì •ê³¼ ì‚¬ìš©ì´ ì‰½ê³ , ë‹¤ì–‘í•œ GitHub ê¸°ëŠ¥ê³¼ í†µí•©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì‘ì€ ê·œëª¨ì—ì„œ ì¤‘ê°„ ê·œëª¨ì˜ GitHub í”„ë¡œì íŠ¸ì— ê°€ì¥ ì í•©í•©ë‹ˆë‹¤.
* **Jenkins**ëŠ” ë§ì€ í•´ê°€ ì§€ë‚œ ì¸ê¸° ìˆëŠ” ì˜¤í”ˆì†ŒìŠ¤ CI/CD ë„êµ¬ì…ë‹ˆë‹¤. ë§¤ìš° ìœ ì—°í•˜ë©° ë‹¤ì–‘í•œ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì™€ ë„êµ¬ì™€ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§ì€ ë§ì¶¤ ì„¤ì •ì´ í•„ìš”í•œ ëŒ€ê·œëª¨, ë³µì¡í•œ í”„ë¡œì íŠ¸ì— ê°€ì¥ ì í•©í•©ë‹ˆë‹¤.
* **Travis CI**ëŠ” GitHub í”„ë¡œì íŠ¸ì— íŠ¹í™”ëœ í´ë¼ìš°ë“œ ê¸°ë°˜ CI/CD ë„êµ¬ì…ë‹ˆë‹¤. ì„¤ì •ê³¼ ì‚¬ìš©ì´ ì‰½ê³ , ë‹¤ì–‘í•œ GitHub ê¸°ëŠ¥ê³¼ í†µí•©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì‘ì€ ê·œëª¨ì—ì„œ ì¤‘ê°„ ê·œëª¨ì˜ GitHub í”„ë¡œì íŠ¸ì— ê°€ì¥ ì í•©í•©ë‹ˆë‹¤.

\


**S3 ìƒì„±í•˜ê¸°**\
í•„ìš”í•œ ë¦¬ì „ì„ ì„ íƒí•˜ê³  ë²„ì „ ê´€ë¦¬ëŠ” í•„ìš”í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì‚¬ìš©í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ì ‘ê·¼ ê°€ëŠ¥í•œ IAM ì‚¬ìš©ìë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ëª¨ë“  í¼ë¸”ë¦­ ì•¡ì„¸ìŠ¤ ì°¨ë‹¨ì„ ì„ íƒí•´ì¤ë‹ˆë‹¤.

\


**EC2 í™˜ê²½ì„¤ì •**\
EC2 ê¸°ë³¸ í™˜ê²½ì„¤ì •ì„ ì§„í–‰í•©ë‹ˆë‹¤. ì œê°€ ë§Œë“  ì¸ìŠ¤í„´ìŠ¤ì˜ ì‚¬ì–‘ì€ Ubuntu 22.04 LTS, t2.micro(í”„ë¦¬í‹°ì–´), 30GiB ìŠ¤í† ë¦¬ì§€ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.\
ë³´ì•ˆì—ëŠ” S3, Codedeployì— full accessê°€ ê°€ëŠ¥í•˜ë„ë¡ ë§Œë“  IAM ì—­í• ì„ ë¶€ì—¬í•©ë‹ˆë‹¤.\
EC2 ì½˜ì†”ì—ì„œ JDKì™€ [Amazon correto](https://docs.aws.amazon.com/corretto/latest/corretto-17-ug/downloads-list.html)ë¥¼ í”„ë¡œì íŠ¸ JDKì™€ ì¼ì¹˜í•˜ëŠ” ê²ƒìœ¼ë¡œ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```
$ sudo apt update
$ sudo apt-get install openjdk-17-jdk
$ sudo wget https://corretto.aws/downloads/latest/amazon-corretto-17-x64-linux-jdk.tar.gz
```

`/etc/profile` ê°€ì¥ ë§ˆì§€ë§‰ ì¤„ì— í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

```
$ sudo nano /etc/profile
$ export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64
$ export PATH=$JAVA_HOME/bin/:$PATH
$ export CLASS_PATH=$JAVA_HOME/lib:$CLASS_PATH
$ sudo reboot now
```

[Ubuntu Serverìš© CodeDeploy ì—ì´ì „íŠ¸ ì„¤ì¹˜](https://docs.aws.amazon.com/ko\_kr/codedeploy/latest/userguide/codedeploy-agent-operations-install-ubuntu.html) ê°€ì´ë“œë¥¼ ë³´ê³  ì—ì´ì „íŠ¸ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤. statusê°€ activeë¼ë©´ ì„±ê³µ!

```
$ sudo apt install ruby
$ cd /home/ubuntu
$ wget https://aws-codedeploy-ap-northeast-2.s3.ap-northeast-2.amazonaws.com/latest/install
$ chmod +x ./install
$ sudo ./install auto
$ sudo service codedeploy-agent status
```

**Github Action ì„¤ì •ë³€ê²½**\
ì•ì—ì„œ ë§Œë“¤ì–´ì¤€ .yml íŒŒì¼ì— `env`ì™€ `jobs` ë‚´ì—­ì„ ìˆ˜ì •í•©ë‹ˆë‹¤. push í›„ ì§„í–‰ë˜ëŠ” ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

1. Set up JDK 17
2. Grant execute permission for gradlew
3. Build with Gradle
4. Make Zip File
5. Configure AWS credentials
6. Upload to S3
7. Code Deploy ë¡œì§ì˜ ê° ë¶€ë¶„ì€ [cicd ì˜¤í”ˆì†ŒìŠ¤](https://github.com/kbsat/cicdproject)ë¥¼ ì°¸ê³ í•´ì„œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

\


**appspec.yml íŒŒì¼ ì‘ì„±**\
CodeDeploy ë™ì‘ì„ ìœ„í•´ `appspec.yml` íŒŒì¼ ì‘ì„±í•©ë‹ˆë‹¤. CodeDeploy agentê°€ ë‹¤ìš´ë¡œë“œ ì½”ë“œë¥¼ ì–´ë”” ê²½ë¡œì—ì„œ ë‹¤ìš´ë°›ì„ì§€, EC2 ì„œë²„ ì–´ë””ì— ì½”ë“œë¥¼ ì €ì¥í• ì§€ ë“±ì„ ì •í•©ë‹ˆë‹¤.\
`afterinstall`ëŠ” ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì„¤ì¹˜ í”„ë¡œì„¸ìŠ¤ê°€ ì™„ë£Œëœ í›„ ì‹¤í–‰ë˜ì–´ì•¼ í•˜ëŠ” ëª…ë ¹ ë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ ëª©ë¡ì„ í¬í•¨í•˜ëŠ” ì„¹ì…˜ì…ë‹ˆë‹¤. ì˜ˆì‹œì—ì„œ afterinstall ì„¹ì…˜ì—ëŠ” AfterInstallì´ë¼ëŠ” ì´ë¦„ì˜ í›…ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ í›…ì€ scripts/deploy.sh ì‰˜ ìŠ¤í¬ë¦½íŠ¸ì˜ ìœ„ì¹˜ë¥¼ ì§€ì •í•˜ë©°, 60ì´ˆì˜ íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ì‹¤í–‰ë˜ë©° ubuntu ì‚¬ìš©ìë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.

```yml
version: 0.0
os: ubuntu

files:
  - source: /
    destination: /home/ubuntu/boardApi
permissions:
  - object: /home/ubuntu/boardApi/
    owner: ubuntu
    group: ubuntu
hooks:
  AfterInstall:
    - location: scripts/deploy.sh
      timeout: 60
      runas: ubuntu
```

\


**ë°°í¬ìš© shell ìŠ¤í¬ë¦½íŠ¸**\
ë¹Œë“œëœ jar íŒŒì¼ì„ ì‹¤í–‰ì‹œí‚¤ê³  ì´ë¯¸ ì‹¤í–‰ë˜ì–´ ìˆë‹¤ë©´ ìƒˆë¡œ ë¹Œë“œëœ jaríŒŒì¼ë¡œ ì‹¤í–‰ë˜ë„ë¡ ì„¤ì •í•´ì¤ë‹ˆë‹¤.

```
#!/usr/bin/env bash

REPOSITORY=/home/ubuntu/boardApi
cd $REPOSITORY

APP_NAME=boardApi
JAR_NAME=$(ls $REPOSITORY/build/libs/ | grep 'SNAPSHOT.jar' | tail -n 1)
JAR_PATH=$REPOSITORY/build/libs/$JAR_NAME

CURRENT_PID=$(pgrep -f $APP_NAME)

if [ -z $CURRENT_PID ]
then
  echo "> ì¢…ë£Œí• ê²ƒ ì—†ìŒ."
else
  echo "> kill -9 $CURRENT_PID"
  kill -15 $CURRENT_PID
  sleep 5
fi

echo "> $JAR_PATH ë°°í¬"
nohup java -jar $JAR_PATH > /dev/null 2> /dev/null < /dev/null &
```

`nohup java -jar $JAR_PATH > /dev/null 2> /dev/null < /dev/null &` ë¶€ë¶„ì€ ë¬´ì¤‘ë‹¨ìœ¼ë¡œ ì‹¤í–‰í•˜ê³ ì í•  ë•Œ `nohup`ì„ ì ìš©í•˜ëŠ” ë¶€ë¶„ì´ë¼ git cloneìœ¼ë¡œ .jar íŒŒì¼ ë°°í¬ ë°©ì‹(ì´í•˜ í¬ìŠ¤íŒ… ë¨)ê³¼ ìœ ì‚¬í•œ ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

**ğŸš´ğŸ½ ì™œ ë¹Œë“œëŠ” ì„±ê³µí–ˆëŠ”ë° APIëŠ” ì‘ë™ì„ ì•ˆí• ê¹Œ?**

ë°°í¬ìš© shell ìŠ¤í¬ë¦½íŠ¸ê¹Œì§€ ì‘ì„±í•˜ê³  ë‚˜ì„œ ë³´ë‹ˆ ë¹Œë“œê°€ ì„±ê³µí–ˆë‹¤ê³  ë‚˜ì™”ëŠ”ë° API í™•ì¸ì„ í•´ë³´ë‹ˆ ë™ì‘í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. `ps -ef | grep java`ë¡œ í™•ì¸í•´ë³´ë‹ˆ .jar íŒŒì¼ì´ êµ¬ë™ë˜ê³  ìˆì§€ ì•Šë‹¤ëŠ” ê²ƒì„ ì•Œì•˜ìŠµë‹ˆë‹¤.\
ì •í™•í•œ ë‚´ìš©ì„ í™•ì¸í•˜ê¸° ìœ„í•´ CodeDeploy ì´ë²¤íŠ¸ ë¡œê·¸ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

> CodeDeploy agent was not able to receive the lifecycle event. Check the CodeDeploy agent logs on your host and make sure the agent is running and can connect to the CodeDeploy server.

ì¼ë‹¨ S3 ë²„í‚·ì—ëŠ” ê°ì²´ê°€ zip íŒŒì¼ í˜•íƒœë¡œ ì˜ ë§Œë“¤ì–´ì ¸ ìˆì—ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  CodeDeploy agent ìƒíƒœ(`sudo service codedeploy-agent status`)ëŠ” ì´ìƒì´ ì—†ì—ˆìŠµë‹ˆë‹¤.\
ê·¸ë ‡ë‹¤ë©´, CodeDeployì—ì„œ ë°°í¬ì— ë¬¸ì œê°€ ìˆëŠ” ê²ƒ ê°™ì•„ agent logê³¼ shell ìŠ¤í¬ë¦½íŠ¸ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

> 2023-08-08T03:17:15 INFO \[codedeploy-agent(24653)]: On Premises config file does not exist or not readable

ì§ì ‘ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ CLIë¡œ Github actionì— ë“±ë¡í•œ Code Deployë¥¼ ì§„í–‰í•´ë´¤ìŠµë‹ˆë‹¤. (run ë‚´ìš©ì— ë³€ìˆ˜ ëŒ€ì…í•´ì„œ ì§„í–‰)

```yml
- name: Code Deploy
  run: aws deploy create-deployment --application-name $CODE_DEPLOY_APP_NAME --deployment-config-name CodeDeployDefault.OneAtATime --deployment-group-name $DEPLOYMENT_GROUP_NAME --s3-location bucket=$BUCKET_NAME,bundleType=zip,key=$PROJECT_NAME/$GITHUB_SHA.zip
```

`aws configure`ì— ë¦¬ì „ì„ ì„¤ì •í•´ì•¼ í•´ì„œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤. ì´ ë¶€ë¶„ì€ Github action .yml ì¡°ê±´ê³¼ì˜ ì¼ì¹˜ì—¬ë¶€ ë•Œë¬¸ì— ë°œìƒí•˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.

```
You must specify a region. You can also configure your region by running "aws configure".
ubuntu@ip-172-31-34-122:~$ aws configure
AWS Access Key ID [****************XGTY]: 
AWS Secret Access Key [****************LL3f]: 
Default region name [None]: ap-northeast-2
```

```yml
- name: Configure AWS credentials
  uses: aws-actions/configure-aws-credentials@v1
  with:
    aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
    aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
    aws-region: ap-northeast-2
```

ì´ë²ˆì—ëŠ” ë‹¤ë¥¸ ë°°í¬ ì‹¤íŒ¨ ì´ë²¤íŠ¸ ë¡œê·¸ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

> The overall deployment failed because too many individual instances failed deployment, too few healthy instances are available for deployment, or some instances in your deployment group are experiencing problems.\
> The specified key does not exist.

ì´ë²¤íŠ¸ ë¡œê·¸ ìƒì„¸ë¥¼ ë³´ë‹ˆ S3 .zip íŒŒì¼ì˜ í‚¤ê°’ì´ ë‹¬ë¼ ì¸ì‹í•˜ì§€ ëª»í•˜ëŠ” ë¬¸ì œì¸ ê²ƒ ê°™ì•„ ì „ì—­ë³€ìˆ˜ë¡œ `GITHUB_SHA`ë¥¼ ë“±ë¡í•´ì£¼ì—ˆìŠµë‹ˆë‹¤. `CodeDeploy`ì—ì„œ DownloadBundle ìƒíƒœê°€ ì§„í–‰ì´ ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

```
env:
  GITHUB_SHA: ${{ github.sha }}
```

\


#### 2. Git cloneì„ ì´ìš©í•œ ìˆ˜ë™ë°°í¬

Githubì—ì„œ ì§ì ‘ ì†ŒìŠ¤ë¥¼ ë‚´ë ¤ë°›ì•„ EC2ì—ì„œ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. ë³„ë„ í”„ë¡œê·¸ë¨ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  AWS ì¸ìŠ¤í„´ìŠ¤ë¡œ ì‰½ê²Œ ì—°ë™í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆìŠµë‹ˆë‹¤.\
EC2 ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì†ŒìŠ¤ì½”ë“œê°€ ìˆëŠ” Githubê³¼ ì—°ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” ssh í‚¤ë¥¼ ë§Œë“¤ì–´ í¼ë¸”ë¦­ í‚¤ë¥¼ githubì— ë“±ë¡í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.

```
ssh-keygen -t rsa -C githubê³„ì • ë©”ì¼(example@github.com)
```

ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ í†µí•´ ì–»ì€ í‚¤ë¥¼ Github ì„¤ì •ì˜ `SSH and GPG keys`ì— ë“±ë¡í•´ì¤ë‹ˆë‹¤.

```
cat /home/ubuntu/.ssh/id_rsa
```

ì´ì œ ë ˆí¬ì˜ SSH ì£¼ì†Œë¥¼ ë³µì‚¬í•´ì„œ cloneì„ ì§„í–‰í•©ë‹ˆë‹¤.

```
git clone {SSH ì£¼ì†Œ}(git@github.com:í”„ë¡œì íŠ¸ëª….git)
```

ì†ŒìŠ¤ íŒŒì¼ì´ ë°›ì•„ì§€ë©´ í”„ë¡œì íŠ¸ ì•ˆì—ì„œ gradlew buildë¥¼ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
cd í”„ë¡œì íŠ¸/build/libs
chmod +x gradlew
```

`nohup`ìœ¼ë¡œ ë¬´ì¤‘ë‹¨ ë°°í¬ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤. ì´ ë•Œ ë°°í¬ê³¼ì •ì— ë¬¸ì œê°€ ìˆë‹¤ë©´ .jar íŒŒì¼ê³¼ ê°™ì€ ë””ë ‰í† ë¦¬ì—ì„œ `nohup.out` íŒŒì¼ì—ì„œ ì—ëŸ¬ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```


```

ì´ ê²½ìš° í”„ë¦¬í‹°ì–´ì—ì„œ ë©”ëª¨ë¦¬ ìš©ëŸ‰ ë¶€ì¡±ìœ¼ë¡œ `gradlew build`í•˜ë©´ ë¬´í•œë¡œë”©ì— ë¹ ì§€ëŠ” ì´ìŠˆê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. [Swap ë©”ëª¨ë¦¬ ì‚¬ìš©](https://sundries-in-myidea.tistory.com/102)í•´ì„œ í•´ê²°í–ˆì§€ë§Œ ì†ŒìŠ¤ì½”ë“œ ë³€ê²½ì‹œë§ˆë‹¤ ìˆ˜ë™ ë°°í¬ë¥¼ í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë²ˆê±°ë¡œìš´ ë°©ë²•ì´ì—ˆìŠµë‹ˆë‹¤.

Swap ë©”ëª¨ë¦¬ë€?\
RAMì˜ ë©”ëª¨ë¦¬ê°€ ë¶€ì¡±í•˜ë¯€ë¡œ, ë¦¬ëˆ…ìŠ¤ì˜ HDD ê³µê°„ì„ RAMì²˜ëŸ¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ë§í•˜ë©´, ì´ë¥¼ í†µí•´ ë¶€ì¡±í•œ RAMì„ ì¦ì„¤í•œ ê²ƒì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

\


#### 3. Filezilaë¥¼ ì´ìš©í•œ war íŒŒì¼ ìˆ˜ë™ë°°í¬

Filezilaì˜ ì„¤ì • `SFTP`ì—ì„œ private keyë¥¼ ì„¤ì •í•´ì„œ ë°°í¬ì„œë²„ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ í¬ìŠ¤íŒ…í•œ tomcat ì´í•˜ webappsì— war íŒŒì¼ì„ ì´ë™ì‹œí‚¤ë©´, ìë™ìœ¼ë¡œ war íŒŒì¼ëª…ì˜ ë””ë ‰í† ë¦¬ íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤.

777ì€ ì†Œìœ ì, ê·¸ë£¹, ê·¸ë¦¬ê³  ë‹¤ë¥¸ ì‚¬ìš©ì ëª¨ë‘ê°€ ì½ê¸°, ì“°ê¸°, ì‹¤í–‰ ê¶Œí•œì„ ê°€ì§„ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì´ëŸ° ì„¤ì •ì€ ë³´ì•ˆìƒ ì·¨ì•½í•©ë‹ˆë‹¤. ì´í•˜ tomcat10 ì„¸íŒ…ê³¼ì •ì—ì„œ í†°ìº£ ì‚¬ìš©ìì—ê²Œ ê¶Œí•œì„ ì£¼ì—ˆì§€ë§Œ íŒŒì¼ì§ˆë¼ì—ì„œ íŒŒì¼ ì „ì†¡ì‹œì—ëŠ” ê¶Œí•œì„ ë” ë„“ê²Œ ì£¼ëŠ” ê²ƒì´ í•„ìš”í•´ì„œ `777` ì„ì‹œ ì„¤ì •ì„ ë‘ì—ˆìŠµë‹ˆë‹¤.

```
sudo chmod -R 777 /opt/tomcat/apache-tomcat-10.1.11/webapps
```

ë””ë ‰í† ë¦¬ì™€ ê·¸ í•˜ìœ„ ë””ë ‰í† ë¦¬, íŒŒì¼ì˜ ëª¨ë“  ì†Œìœ ìë¥¼ tomcat ì‚¬ìš©ìë¡œ, ê·¸ë£¹ì„ tomcat ê·¸ë£¹ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•¨ìœ¼ë¡œì¨ í•´ë‹¹ ë””ë ‰í† ë¦¬ì™€ íŒŒì¼ë“¤ì€ tomcat ì‚¬ìš©ìì™€ ê·¸ë£¹ì— ì†í•˜ê²Œ ë©ë‹ˆë‹¤.

```
sudo chown -R tomcat:tomcat /opt/tomcat/apache-tomcat-10.1.11/webapps
```

\
\


### AWS EC2 Ubuntu22.04LTS tomcat10 ì„¸íŒ…í•˜ê¸°

**ë“¤ì–´ê°€ë©°**\
ì‚¬ì „ë¯¸ì…˜ì„ í•˜ê²Œ ë˜ì–´ ì˜¤ë«ë§Œì— EC2 í™˜ê²½ êµ¬ì¶•ì„ í•˜ê²Œ ë˜ì—ˆëŠ”ë° ë²„ì „ ë³€ê²½ìœ¼ë¡œ ì¸í•œ ì°¨ì´ê°€ ë°œìƒí•´ì„œ ì´ë²ˆì— ì•Œê²Œ ëœ ë‚´ìš©ì„ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.\
ì•„ë˜ ë²„ì „ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, ì´ì „ ì œ ë¸”ë¡œê·¸ì— [Ubuntu 20.x tomcat9 êµ¬ì¶•](https://ilpyoyang.tistory.com/145) ë‚´ìš©ì„ ì°¸ê³ í•´ì£¼ì„¸ìš”.

\


**ì„¤ì¹˜ê³¼ì •**\
í†°ìº£ êµ¬ë™ì „ì— í•„ìš”í•œ JDK íŒŒì¼ì„ ì„¤ì¹˜í•´ ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. ì°¸ê³ ë¡œ ì €ëŠ” ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œ JDK 17ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.\
"tomcat"ì´ë¼ëŠ” ì´ë¦„ì˜ ì‚¬ìš©ìë¥¼ `/opt/tomcat` ê²½ë¡œì— í™ˆ ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•˜ë©°, ë¡œê·¸ì¸ ì‰˜ì´ ë¹„í™œì„±í™”ëœ ìƒíƒœë¡œ ì¶”ê°€í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì„¤ì •ì€ ë³´ì•ˆ ìƒì˜ ì´ìœ ë¡œ "tomcat" ì‚¬ìš©ìê°€ ì¼ë°˜ì ì¸ ì‹œìŠ¤í…œ ë¡œê·¸ì¸ì„ í•˜ì§€ ëª»í•˜ê²Œ í•˜ë©´ì„œ íŠ¹ì • ì‘ì—…ì—ë§Œ ì œí•œëœ ê¶Œí•œìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ Tomcatê³¼ ê°™ì€ ì›¹ ì„œë²„ ë˜ëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì˜ ì‹¤í–‰ì„ ìœ„í•´ íŠ¹ì • ì‚¬ìš©ìì™€ ê·¸ë£¹ì„ ìƒì„±í•˜ëŠ” ë° ìì£¼ ì‚¬ìš©ë©ë‹ˆë‹¤.

```
sudo useradd -m -U -d /opt/tomcat -s /bin/false tomcat
```

ì›í•˜ëŠ” ì•„íŒŒì¹˜ í†°ìº£ ë²„ì „ì„ í™•ì¸í•˜ê³  ì„¤ì¹˜í•©ë‹ˆë‹¤.

```
VERSION=10.1.11
wget https://www-eu.apache.org/dist/tomcat/tomcat-10/v${VERSION}/bin/apache-tomcat-${VERSION}.tar.gz -P /tmp
sudo tar -xf /tmp/apache-tomcat-${VERSION}.tar.gz -C /opt/tomcat/
```

`/opt/tomcat` ë””ë ‰í† ë¦¬ê°€ ì—†ëŠ” ê²½ìš°ëŠ” ë¯¸ë¦¬ ìƒì„±í•˜ê³  ì••ì¶•ì„ í’€ì–´ì¤ë‹ˆë‹¤.

```
sudo mkdir -p /opt/tomcat
```

`/opt/tomcat/latest` ê²½ë¡œì— `apache-tomcat-${VERSION}`ë¼ëŠ” ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ì‚¬ìš©í•˜ë©´ Tomcatì´ë‚˜ ë‹¤ë¥¸ í”„ë¡œê·¸ë¨ì˜ ë²„ì „ì„ ì—…ë°ì´íŠ¸í•  ë•Œ ìƒˆë¡œìš´ ë²„ì „ì„ /opt/tomcat/latestì— ë§í¬ë¡œ ì—°ê²°í•˜ì—¬ ê¸°ì¡´ì— ì‚¬ìš© ì¤‘ì´ë˜ ìŠ¤í¬ë¦½íŠ¸ë‚˜ ì„¤ì • ë“±ì´ ìƒˆë¡œìš´ ë²„ì „ì„ ê°€ë¦¬í‚¤ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
sudo ln -s /opt/tomcat/apache-tomcat-${VERSION} /opt/tomcat/latest
```

í•´ë‹¹ ê²½ë¡œì˜ ì ‘ê·¼, íŒŒì¼ ìˆ˜ì • ë“±ì„ ìš©ì´í•˜ê²Œ í•˜ê¸° ìœ„í•´ ì†Œìœ ê¶Œê³¼ ê¶Œí•œì„ ì„¤ì •í•©ë‹ˆë‹¤.

```
sudo chown -R tomcat: /opt/tomcat
sudo sh -c 'chomd +x /opt/tomcat/latest/bin/*.sh' 
```

`tomcat.service` íŒŒì¼ì„ ìƒì„±í•´ ì‹œìŠ¤í…œì´ ë¶€íŒ…ë  ë•Œ ìë™ìœ¼ë¡œ ì‹œì‘ë˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë°ëª¬ìœ¼ë¡œ ì‹¤í–‰í•˜ê²Œ ì„¤ì •í•©ë‹ˆë‹¤.

```
sudo nano /etc/systemd/system/tomcat.service
```

ì„¤ì • íŒŒì¼ ì•ˆì— ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```
[Unit]
Description=Apache Tomcat Web Application Container
After=network.target

[Service]
Type=forking
User=tomcat
Group=tomcat
Environment="JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64"
Environment="JAVA_OPTS=-Djava.security.egd=file:///dev/urandom -Djava.awt.he>

Environment="CATALINA_BASE=/opt/tomcat/latest"
Environment="CATALINA_HOME=/opt/tomcat/latest"
Environment="CATALINA_PID=/opt/tomcat/latest/temp/tomcat.pid"
Environment="CATALINA_OPTS="-Xms512M -Xmx1024M -server -XX:+UserParallelGC"

ExecStart=/opt/tomcat/latest/bin/startup.sh
ExecStop=/opt/tomcat/latest/bin/shutdown.sh

[Install]
WantedBy=multi-user.target
```

service íŒŒì¼ì„ ì¶”ê°€í–ˆìœ¼ë¯€ë¡œ `daemon-reload`í•´ ë³€ê²½ ë‚´ìš©ì„ ê°ì§€í•˜ë„ë¡ í•©ë‹ˆë‹¤.

```
sudo systemctl daemon-reload
```

ì´ì œ `systemctl` ëª…ë ¹ì–´ë¡œ í†°ìº£ì„ êµ¬ë™í•©ë‹ˆë‹¤. `status`ë¡œ tomcatì˜ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
sudo systemctl enable --now tomcat
sudo systemctl status tomcat
```

![20230805\_213359.png](../assets/gitbook/post\_images/aws/20230805\_213359.png)

tomcatì´ ì œëŒ€ë¡œ êµ¬ë™í•˜ì§€ ì•ŠëŠ” ê²½ìš°ì—ëŠ” log ë””ë ‰í† ë¦¬ì— `catalina.out`ì„ í™•ì¸í•´ ì„¤ì •ì‚¬í•­ì— ë¬¸ì œê°€ ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì €ì˜ ê²½ìš°ì—ëŠ” `tomcat.service` ìƒì— ì…ë ¥ì‚¬í•­ì´ ì˜ëª»ë˜ì–´ í†°ìº£ì´ ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•Šì•˜ì—ˆìŠµë‹ˆë‹¤.

```
sudo vi /opt/tomcat/latest/log/catalina.out
```

\


**í†°ìº£ êµ¬ë™ì¥ë©´**\
ì™„ë£Œí•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ `í¼ë¸”ë¦­IP ì£¼ì†Œ:8080`ìœ¼ë¡œ ì œëŒ€ë¡œ êµ¬ë™ë˜ëŠ” ëª¨ìŠµì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![20230805\_211921.png](../assets/gitbook/post\_images/aws/20230805\_211921.png)

\
\


### AWS ì„œë¹„ìŠ¤ ë¶„ë¥˜

**ì»´í“¨íŒ… ì„œë¹„ìŠ¤**

* EC2, Auto Scaling, Lambda, Lightsail, WorkSpaces, ECS, EB

**ë„¤íŠ¸ì›Œí‚¹ ì„œë¹„ìŠ¤**

* VPC, Route53, Direct Connect, ELB, CloudFront, Transit Gateway

**ìŠ¤í† ë¦¬ì§€ ì„œë¹„ìŠ¤**

* S3, EBS, Glacier, Storage Gateway, Snowball

**ë°ì´í„°ë² ì´ìŠ¤ ì„œë¹„ìŠ¤**

* RDS, DynamoDB, ElastiCache, DocumentDB

**ê´€ë¦¬ íˆ´**

* CloudWatch, CloudFormation

**ë¶„ì„ í”Œë«í¼**

* Kinesis, Redshift, EMR

**ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤**

* CloudSearch, SES, Elastic Transcoder

\
\


### AWS Lambda

AWS Lambdaë¥¼ ì‚¬ìš©í•˜ë©´ ì„œë²„ë¥¼ í”„ë¡œë¹„ì €ë‹í•˜ê±°ë‚˜ ê´€ë¦¬í•  í•„ìš” ì—†ì´ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì„œë²„ë¦¬ìŠ¤ ì»´í“¨íŒ… ì‹œìŠ¤í…œì…ë‹ˆë‹¤.\
AWS LambdaëŠ” ì½”í‹€ë¦°ë„ ì§€ì›í•˜ëŠ”ê°€?\
ì§€ì›ìœ¼ë¡œ ëª…ì‹œí•˜ì§€ ì•Šì§€ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. AWS LambdaëŠ” ê¸°ë³¸ì ìœ¼ë¡œ Java, Go, PowerShell, Node.js, C#, Python ë° Ruby ì½”ë“œë¥¼ ì§€ì›í•œë‹¤ê³  ëª…ì‹œë˜ì–´ ìˆìŠµë‹ˆë‹¤. LambdaëŠ” `kotlinx.serialization` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì§€ì›í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— Kotlin ë°ì´í„° í´ë˜ìŠ¤ë¡œ JSON ê°ì²´ì˜ ì§ë ¬í™”í•˜ëŠ” ê²ƒì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ, Java ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ `Jackson`, `Gson`ê³¼ ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì œê³µí•˜ê¸° ë•Œë¬¸ì— ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ì„œ ì—­ì§ë ¬í™”ë¥¼ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```kotlin
import kotlinx.serialization.*
import kotlinx.serialization.json.*

@Serializable
data class Person(val name: String, val age: Int)

fun main() {
    val person = Person("Alice", 30)
    val jsonString = Json.encodeToString(person)
    println(jsonString) // ì¶œë ¥: {"name":"Alice","age":30}

    val json = Json { ignoreUnknownKeys = true }
    val personObj = json.decodeFromString<Person>(jsonString)
    println(personObj) // ì¶œë ¥: Person(name=Alice, age=30)
}
```

***

[AWS Lambda FAQ](https://aws.amazon.com/ko/lambda/faqs/)\
[Kotlin and Groovy JVM Languages with AWS Lambda](https://aws.amazon.com/ko/blogs/compute/kotlin-and-groovy-jvm-languages-with-aws-lambda/)
