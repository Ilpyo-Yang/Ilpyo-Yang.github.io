---
title: Spring
author: Rosie Yang
date: 2023-04-14
category: backend
layout: post
---

+ [ğŸš´ğŸ½ Spring-Security ì˜¤í”ˆì†ŒìŠ¤ì— ê¸°ì—¬í•˜ê¸° (ì§„í–‰ì¤‘)]({{site.baseurl}}/backend/2023/04/14/Spring.html#-spring-security-ì˜¤í”ˆì†ŒìŠ¤ì—-ê¸°ì—¬í•˜ê¸°-ì§„í–‰ì¤‘)
+ [ğŸš´ğŸ½ Spring-Batch ì˜¤í”ˆì†ŒìŠ¤ì— ê¸°ì—¬í•˜ê¸°]({{site.baseurl}}/backend/2023/04/14/Spring.html#-spring-batch-ì˜¤í”ˆì†ŒìŠ¤ì—-ê¸°ì—¬í•˜ê¸°)
+ [ğŸ“– Spring Security in Action]({{site.baseurl}}/study/2023/04/14/Spring_security_in_action.html)
+ [ğŸ“– ìŠ¤í”„ë§ ë¶€íŠ¸ì™€ JPA ì‹¤ë¬´ ì™„ì „ ì •ë³µ ë¡œë“œë§µ]({{site.baseurl}}/study/2023/04/15/JPA_inflearn_roadmap.html)
+ [ğŸš´ğŸ½ ë‚´ Github action unit-testëŠ” ì™œ ì•ˆ í†µê³¼í–ˆì„ê¹Œ?]({{site.baseurl}}/backend/2023/04/14/Spring.html#-ë‚´-github-action-unit-testëŠ”-ì™œ-ì•ˆ-í†µê³¼í–ˆì„ê¹Œ)
+ [ğŸš´ğŸ½ @Password ì‚¬ìš©ì ì •ì˜ ì–´ë…¸í…Œì´ì…˜ ìƒì„±ê³¼ yml ì†ì„± mapping error í•´ê²°í•˜ê¸°]({{site.baseurl}}/backend/2023/04/14/Spring.html#-password-ì‚¬ìš©ì-ì •ì˜-ì–´ë…¸í…Œì´ì…˜-ìƒì„±ê³¼-yml-ì†ì„±-mapping-error-í•´ê²°í•˜ê¸°)
+ [ğŸš´ğŸ½ ì•”í˜¸í™”ì™€ authentication ì´ìŠˆ]({{site.baseurl}}/backend/2023/04/14/Spring.html#-ì•”í˜¸í™”ì™€-authentication-ì´ìŠˆ)
+ [Spring Triangle]({{site.baseurl}}/backend/2023/04/14/Spring.html#spring-triangle)
+ [ì—”í‹°í‹° ì„¤ê³„ì‹œ ì£¼ì˜ì ]({{site.baseurl}}/backend/2023/04/14/Spring.html#ì—”í‹°í‹°-ì„¤ê³„ì‹œ-ì£¼ì˜ì )
+ [@Transactional]({{site.baseurl}}/backend/2023/04/14/Spring.html#transactional)
+ [Lombok]({{site.baseurl}}/backend/2023/04/14/Spring.html#lombok)

## ğŸš´ğŸ½ Spring-Security ì˜¤í”ˆì†ŒìŠ¤ì— ê¸°ì—¬í•˜ê¸° (ì§„í–‰ì¤‘)
> Issue : [ConcurrentSessionFilter breaks permitAll endpoint on session expiration](https://github.com/spring-projects/spring-security/issues/14077)  
> PR : [Add ContinueRequestSessionInformationExpiredStrategy](https://github.com/spring-projects/spring-security/pull/14765)

##### ë“¤ì–´ê°€ë©°
ì‘ë…„ ì˜¤í”ˆì†ŒìŠ¤ ìŠ¤í„°ë”” ë•Œ [Spring-batch ì˜¤í”ˆì†ŒìŠ¤ì— ê¸°ì—¬í•˜ê¸°](https://ilpyo-yang.github.io/backend/2023/04/14/Spring.html#-spring-batch-ì˜¤í”ˆì†ŒìŠ¤ì—-ê¸°ì—¬í•˜ê¸°)ë¡œ ì»¨íŠ¸ë¦¬ë·°í„°ê°€ ë  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
ê·¸ ì´í›„ì—ë„ ê¸°ì—¬ë¥¼ í•´ì•¼ì§€ë¼ê³  ë‹¤ì§í–ˆì§€ë§Œ ê²°êµ­ ë‘ ë²ˆì§¸ ìŠ¤í„°ë””ì— ì°¸ì—¬í•´ì„œì•¼ Spring-Security PRì„ ì˜¬ë¦¬ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

##### ì˜¤í”ˆì†ŒìŠ¤ ë¶„ì„ ë° í•´ê²°ë°©ì•ˆ
ì´ìŠˆ ìì²´ëŠ” ë™ì‹œì ‘ì†ì„ ê´€ë¦¬í•˜ëŠ” ConcurrentSessionFilterì—ì„œ session ê´€ë¦¬ë¥¼ í•˜ê³  ìˆëŠ”ë°, ì—¬ê¸°ì„œ sessionì´ ë§Œë£Œëœ ê²½ìš°ì— ëŒ€í•´ì„œëŠ” ë³„ë„ ì²˜ë¦¬ì—†ì´ early return ì²˜ë¦¬ë¥¼ í•´ë²„ë¦¬ê¸° ë•Œë¬¸ì— ì´í›„ì˜ filter ì²˜ë¦¬ê°€ ì´ë¤„ì§€ì§€ ì•ŠëŠ”ë‹¤ëŠ” ë¬¸ì œì˜€ìŠµë‹ˆë‹¤. 
ì—¬ê¸°ì„œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë©”ì¸í…Œì´ë„ˆê°€ ë°©í–¥ì„±ì„ ì œì‹œí•´ ë†“ì€ ì´ìŠˆì˜€ê¸° ë•Œë¬¸ì— ì‰½ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.  
```java
static class ContinueRequestSessionInformationExpiredStrategy implements SessionInformationExpiredStrategy {
	@Override
	public void onExpiredSessionDetected(SessionInformationExpiredEvent event) throws ServletException, IOException {
		event.getFilterChain().doFilter(event.getRequest(), event.getResponse());
	}
}
```
êµ¬í˜„ì‹œ ê³ ë¯¼í•œ ë¶€ë¶„ì€ `ContinueRequestSessionInformationExpiredStrategy`ë¥¼ ìƒì„±í•´ì„œ default ì „ëµìœ¼ë¡œ ê°€ì§€ê³  ê°€ì•¼í•˜ëŠ” ë¶€ë¶„ì¸ê°€ ì•„ë‹ˆë©´ ì‚¬ìš©ì ì…ë§›ì— ë§ëŠ” ì „ëµìœ¼ë¡œ ì•Œì•„ì„œ ë„£ì„ ìˆ˜ ìˆê²Œ í•˜ëŠëƒì˜ ë¬¸ì œì˜€ìŠµë‹ˆë‹¤. 
ê¸°ì¡´ì˜ ì„¸ì…˜ ì „ëµìœ¼ë¡œëŠ” `ResponseBodySessionInformationExpiredStrategy`ë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ”ë° ë‹¨ìˆœíˆ ì„¸ì…˜ ë§Œë£Œë¥¼ returní•˜ëŠ” ì „ëµì´ì—ˆìŠµë‹ˆë‹¤.
ì¼ë‹¨ PR ìì²´ëŠ” ë©”ì¸í…Œì´ë„ˆ ì œì‹œ ì½”ë“œë¥¼ í•˜ë‚˜ì˜ í´ë˜ìŠ¤ë¡œ ë³„ë„ë¡œ ë§Œë“¤ì–´ì„œ ë‹¤ë¥¸ ì „ëµì²˜ëŸ¼ ì„ íƒí•  ìˆ˜ ìˆê²Œ ê·¸ë¦¬ê³  ê·¸ê±¸ë¡œ ConcurrentSessionFilter ì„¸íŒ…í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì ìš©í–ˆìŠµë‹ˆë‹¤. 
default ì²˜ë¦¬ë¥¼ í•  ìˆ˜ë„ ìˆì—ˆì§€ë§Œ ì„¸ì…˜ ì¢…ë£Œ í›„ ì´ì–´ì§€ëŠ” í•„í„°ë¥¼ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ì˜¤íˆë ¤ ë¶ˆí•„ìš”í•œ ê³¼ì •ì´ ë  ìˆ˜ë„ ìˆì„ ê²ƒì´ë¼ëŠ” ìƒê°ì´ì—ˆìŠµë‹ˆë‹¤. í˜„ì¬ ì´ ë¶€ë¶„ì€ ë©”ì¸í…Œì´ë„ˆì™€ ì¡°ìœ¨í•˜ë©´ì„œ ë³€ê²½í•  ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤. 

##### ìŠ¤í„°ë”” íšŒê³ 
ì €ë²ˆ ìŠ¤í„°ë””ëŠ” 1ë‹¬ë™ì•ˆ í•˜ëŠ”ê±°ë¼ì„œ ì•½ê°„ ì¤‘ê°„ì¤‘ê°„ ë‚˜íƒœí•´ì¡Œë˜ ê²ƒ ê°™ì€ë° ì´ë²ˆì—ëŠ” 1ì£¼ì¼ ë™ì•ˆ ì´ìŠˆë¥¼ ì •í•˜ê³  í•˜ë£¨ ë‚  ì¡ì•„ì„œ 2ì‹œê°„ ì•ˆì— PRì˜¬ë¦¬ê¸°ë¥¼ í–ˆë”ë‹ˆ ë” ëª°ì…í•´ì„œ í•  ìˆ˜ ìˆì—ˆë˜ ì ì´ ì¢‹ì•˜ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ì´ì „ì— Spring security in Actionì„ ì±…ìœ¼ë¡œ ë³´ë©´ì„œ ê³µë¶€í•  ë•ŒëŠ”
ì•½ê°„ ì§€ë£¨í•  ë•Œë„ ìˆì—ˆëŠ”ë° ì˜¤íˆë ¤ ì‹¤ì œ ì½”ë“œë¥¼ ë³´ë©´ì„œ ì ‘í•˜ë‹ˆê¹Œ ë” ì´í•´ê°€ ë¹ ë¥´ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

<br><br>

## ğŸš´ğŸ½ Spring-Batch ì˜¤í”ˆì†ŒìŠ¤ì— ê¸°ì—¬í•˜ê¸°
> Issue : [StepBuilder - issue when setting the taskExecutor before faultTolerant()](https://github.com/spring-projects/spring-batch/issues/4438)  
> PR : [Add AbstractTaskletStepBuilder copy constructor](https://github.com/spring-projects/spring-batch/pull/4471) 

##### ë“¤ì–´ê°€ë©°
ì˜¤í”ˆì†ŒìŠ¤ ê¸°ì—¬ ìŠ¤í„°ë””ë¥¼ í†µí•´ ```spring-batch``` ê¸°ì—¬ì— ì°¸ì—¬í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. 
ì´ìŠˆ ì„ ì •ì˜ ëª©í‘œëŠ” ë‹¹ì‹œì— ì²˜ìŒ ì˜¤í”ˆì†ŒìŠ¤ë¥¼ ì°¸ì—¬í•˜ëŠ” ê²ƒì´ë¼ì„œ <span style="background-color:#fff5b1">ìš•ì‹¬ë‚´ì§€ ì•Šê³ , ì‰¬ìš°ë©´ì„œ ì¤‘ìš”í•œ ì˜¤í”ˆì†ŒìŠ¤ì— ê¸°ì—¬í•´ë³´ì</span>ëŠ” ë‹¨ìˆœí•œ ëª©í‘œë¥¼ ê°€ì§€ê³  ì‹œì‘í–ˆìŠµë‹ˆë‹¤. 
GDG ì˜¤í”ˆì†ŒìŠ¤ ìŠ¤í„°ë””ì— ì°¸ì—¬í•´ì„œ ìŠ¤í„°ë”” ìš´ì˜ì ë¶„ê³¼ ë‹¤ë¥¸ ìŠ¤í„°ë”” ì°¸ì—¬í•˜ì‹œëŠ” ë¶„ë“¤ì˜ PR ì°¸ì—¬ë¥¼ ë…¸ì…˜ìœ¼ë¡œ ë³´ë©´ì„œ ê¸°í•œ ë‚´ì— PRë¥¼ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
(ì•„ì§ merge ë°˜ì˜ë˜ì§€ ì•Šì•˜ì§€ë§Œ ë©”ì¸í…Œì´ë„ˆê°€ í™•ì¸í•œ ìƒíƒœì…ë‹ˆë‹¤.)

##### Spring batchì— ëŒ€í•œ ê°„ëµ ì„¤ëª…
Springì€ ì›Œë‚™ ìœ ëª…í•œ ì˜¤í”ˆì†ŒìŠ¤ì´ê¸° ë•Œë¬¸ì— ë‹¤ë“¤ ì•Œê² ì§€ë§Œ spring-batchì˜ ë°°ì¹˜ ì¡ì„ ì‚¬ìš©í•  í”„ë¡œì íŠ¸ê°€ ì•„ë‹Œ ì´ìƒ ì‚¬ìš©í•´ë³´ì§€ ì•Šì€ ì‚¬ëŒë„ ë§ì€ ê²ƒ ê°™ìŠµë‹ˆë‹¤.
ì €ë„ ì•Œê³ ëŠ” ìˆì—ˆì§€ë§Œ ì˜¤í”ˆì†ŒìŠ¤ë¡œ ë‚´ë¶€ ì˜¤í”ˆì†ŒìŠ¤ë¥¼ ë³¸ ê²ƒì€ ì²˜ìŒì´ì—ˆìŠµë‹ˆë‹¤.  

Spring batchëŠ” <span style="background-color:#fff5b1">ëŒ€ëŸ‰ì˜ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ê²½ëŸ‰, í¬ê´„ì ì¸ ë°°ì¹˜ í”„ë ˆì„ì›Œí¬</span>ì…ë‹ˆë‹¤.   
ë¨¼ì € ```step```ì€ ```ItemReader```, ```ItemProcessor```, ```ItemWriter```ì™€ ê°™ì€ êµ¬ì„±ìš”ì†Œë¥¼ í¬í•¨í•˜ë©°, íŠ¹ì • ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. ë°ì´í„° ì²­í¬ ë‹¨ìœ„ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•˜ë©° í•˜ë‚˜ ì´ìƒì˜ ```step```ìœ¼ë¡œ ```job```ì„ êµ¬ì„±í•©ë‹ˆë‹¤.  
```job```ì€ ë°°ì¹˜ ì²˜ë¦¬ì˜ ì‹¤í–‰ ë‹¨ìœ„ë¡œ ```JobInstance```ë¡œ ê°„ì£¼ë˜ë©°, ```JobParameter```ì— ì˜í•´ êµ¬ë¶„ë©ë‹ˆë‹¤.```JobExecution```ìœ¼ë¡œ ì‹¤í–‰ì— ëŒ€í•œ ê¸°ë¡ì„ ë‹´ìŠµë‹ˆë‹¤.  

![stepbuilder1.png](/assets/gitbook/post_images/spring/stepbuilder1.png)

##### ì´ìŠˆ ë‚´ìš©
[ì´ìŠˆ](https://github.com/spring-projects/spring-batch/issues/4438)ê°€ ê°„ë‹¨í•˜ê³  í…ŒìŠ¤íŠ¸ì½”ë“œë¥¼ ì˜ ì‘ì„±í•´ì£¼ì…”ì„œ í•œ ë²ˆì— ì´í•´í•˜ê¸° í¸í–ˆìŠµë‹ˆë‹¤.  
```step```ì„ ë§Œë“¤ ë•Œ, ```taskExecutor()```ì˜ ìœ„ì¹˜ì— ë”°ë¼ í•„ë“œ ê°’ì´ ì˜ ìƒì†ë˜ì§€ ì•ŠìŒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```java
TaskletStep step1 = new StepBuilder("step-name", jobRepository)
                .chunk(10, transactionManager)
                .reader(itemReader)
                .processor(itemProcessor)
                .writer(itemWriter)
                .faultTolerant()
                .taskExecutor(taskExecutor)
                .build();
TaskletStep step2 = new StepBuilder("step-name", jobRepository)
                .chunk(10, transactionManager)
                .taskExecutor(taskExecutor)// The task executor is set before faultTolerant()
                .reader(itemReader)
                .processor(itemProcessor)
                .writer(itemWriter)
                .faultTolerant()
                .build();
```

##### ì˜¤í”ˆì†ŒìŠ¤ ë¶„ì„
```TaskletStep```ê°€ ë§Œë“¤ì–´ì§€ëŠ” ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì¡°ë„ë¡œ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
```
StepBuilderHelper
|
|-- AbstractTaskletStepBuilder
    |
    |-- SimpleStepBuilder
        |
        |-- FaultTolerantStepBuilder
            |
            |-- TaskletStep
```

```StepBuilder```ë¡œ ```TaskletStep```ì„ ìƒì„±í•  ë•Œ, ```.faultTolerant()```ëŠ” ```FaultTolerantStepBuilder```ì˜ ì˜í–¥ì„ ë°›ê³ , ```.taskExecutor(taskExecutor)```ëŠ” ```AbstractTaskletStepBuilder```ì˜ ë©”ì†Œë“œê°€ ì ìš©ë©ë‹ˆë‹¤.  
```faultTolerant()```ë¥¼ ì ìš©í•˜ë¯€ë¡œì„œ ```TaskletStep```ì´ ìƒì„±ë  ë•Œ ì²­í¬ ì§€í–¥ì˜ ì‹œìŠ¤í…œ êµ¬í˜„ì‹œ ì‹¤íŒ¨í•œ ì•„ì´í…œì˜ ì¬ì‹œë„(retry)ì™€ ìŠ¤í‚µ(skip) ê¸°ëŠ¥ì„ í¬í•¨í•˜ê²Œ ë©ë‹ˆë‹¤.
```java
// FaultTolerantStepBuilder faultTolerant()
public FaultTolerantStepBuilder<I, O> faultTolerant() {
  return new FaultTolerantStepBuilder<>(this);
}
```
```taskExecutor(taskExecutor)```ëŠ” ```AbstractTaskletStepBuilder``` ì†ì„± ì¤‘ ```taskExecutor```ë¥¼ ë„£ì–´ì¤€ ë§¤ê°œë³€ìˆ˜ë¡œ ë³€ê²½í•˜ê³  ```SimpleStepBuilder``` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.
ì—¬ê¸°ì„œ ```B```ëŠ” ```AbstractTaskletStepBuilder``` ë˜ëŠ” ê·¸ í•˜ìœ„ í´ë˜ìŠ¤ì˜ íƒ€ì…ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
```java
// AbstractTaskletStepBuilder taskExecutor(taskExecutor)
public B taskExecutor(TaskExecutor taskExecutor) {
  this.taskExecutor = taskExecutor;
  return self();
}
```

```SimpleStepBuilder```ì˜ ìƒì„±ìë¥¼ ë³´ë©´ ë¶€ëª¨ ê°ì²´ì˜ ì†ì„±ë“¤ì„ ë°›ì•„ì„œ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ë³µì‚¬ ìƒì„±ìë¥¼ ë§Œë“œëŠ” ë‘ ê°€ì§€ ë°©ë²•ì´ ì‚¬ìš©ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```java
public SimpleStepBuilder(StepBuilderHelper<?> parent) {
	super(parent);
}
protected SimpleStepBuilder(SimpleStepBuilder<I, O> parent) {
    super(parent);
    this.chunkSize = parent.chunkSize;
    this.completionPolicy = parent.completionPolicy;
    this.chunkOperations = parent.chunkOperations;
    this.reader = parent.reader;
    this.writer = parent.writer;
    this.processor = parent.processor;
    this.itemListeners = parent.itemListeners;
    this.readerTransactionalQueue = parent.readerTransactionalQueue;
    this.meterRegistry = parent.meterRegistry;
}
```

í•˜ì§€ë§Œ ```AbstractTaskletStepBuilder```ì˜ ë³µì‚¬ ìƒì„±ìê°€ ì—†ê³  ë‹¨ìˆœíˆ ë¶€ëª¨ ê°ì²´ ì†ì„±ì„ ë°›ì•„ì˜¤ëŠ” ```super()``` ì²˜ë¦¬ ìƒì„±ìë§Œ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```java
public AbstractTaskletStepBuilder(StepBuilderHelper<?> parent) {
  super(parent);
}
```

##### í•´ê²°ë°©ì•ˆ
```AbstractTaskletStepBuilder```ì˜ ë³µì‚¬ ìƒì„±ìë¥¼ ì¶”ê°€í•˜ë¯€ë¡œì„œ í•„ë“œ updateê°€ ê°€ëŠ¥í•˜ë„ë¡ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤.
```java
public AbstractTaskletStepBuilder(AbstractTaskletStepBuilder<?> parent) {
    super(parent);
    this.chunkListeners = parent.chunkListeners;
    this.stepOperations = parent.stepOperations;
    this.transactionManager = parent.transactionManager;
    this.transactionAttribute = parent.transactionAttribute;
    this.streams.addAll(parent.streams);
    this.exceptionHandler = parent.exceptionHandler;
    this.throttleLimit = parent.throttleLimit;
    this.taskExecutor = parent.taskExecutor;
}
```

í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í–ˆëŠ”ë°, ì˜¤í”ˆì†ŒìŠ¤ ê¸°ì—¬ì—ì„œ ```contribute``` íŒŒì¼ì´ë‚˜ ```readme``` ë‚´ìš©ì„ ë³´ê³  ì„¤ì •í•œ ë‚´ìš©ëŒ€ë¡œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ ë©ë‹ˆë‹¤.  
```@BeforeEach```ë¡œ ê³µí†µìœ¼ë¡œ í…ŒìŠ¤íŠ¸ì— ì‚¬ìš©ë  ```simpleStepBuilder``` ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤. ì½”ë“œ ìˆ˜ì •ì€ ```AbstractTaskletStepBuilder``` ìì²´ëŠ” ì¶”ìƒí´ë˜ìŠ¤ì´ë¯€ë¡œ ë¹„êµë¥¼ ìœ„í•œ êµ¬í˜„ì²´ë¡œ ```simpleStepBuilder```ë¥¼ ì´ìš©í–ˆìŠµë‹ˆë‹¤.  
ë³µì‚¬ ìƒì„±ìê°€ ì˜ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œì™€ ```taskExecutor()```ë¥¼ ë¨¼ì €í•˜ê³  ```faultTolerant()```ë¥¼ ì´í›„ì— í–ˆì„ ë•Œ ê°’ì„ ë¹„êµí•˜ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.  

ì—¬ê¸°ì„œ,``` SimpleStepBuilder```ì˜ ì†ì„±ê°’ì€ ```private```ë¡œ ì ‘ê·¼ì´ ì–´ë µê¸° ë•Œë¬¸ì— ìë°” APIì¸ **ë¦¬í”Œë ‰ì…˜**ì„ ì´ìš©í–ˆìŠµë‹ˆë‹¤.
<span style="background-color:#fff5b1">ë¦¬í”Œë ‰ì…˜ì€ ëŸ°íƒ€ì„ì— í´ë˜ìŠ¤ì˜ ì •ë³´ë¥¼ ì¡°íšŒí•˜ê³ , ê°ì²´ì˜ í•„ë“œë‚˜ ë©”ì„œë“œì— ì ‘ê·¼í•˜ê±°ë‚˜, í´ë˜ìŠ¤ì˜ ê°ì²´ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” ë“±ì˜ ì‘ì—…ì„ ê°€ëŠ¥í•˜ê²Œ í•´ì£¼ëŠ” ìë°” APIì…ë‹ˆë‹¤.</span> 
```field.setAccessible(true)```ì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ declare í•„ë“œì˜ ì ‘ê·¼ì„ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (```accessPrivateField``` ë©”ì„œë“œ)

```java
@SpringBatchTest
@SpringJUnitConfig
public class AbstractTaskletStepBuilderTests {
	private final JobRepository jobRepository =  mock(JobRepository.class);
	private final int chunkSize = 10;
	private final ItemReader itemReader = mock(ItemReader.class);
	private final ItemProcessor itemProcessor = mock(ItemProcessor.class);
	private final ItemWriter itemWriter = mock(ItemWriter.class);
	private final SimpleAsyncTaskExecutor taskExecutor  = new SimpleAsyncTaskExecutor();
	SimpleStepBuilder simpleStepBuilder;

	private <T> T accessPrivateField(Object o, String fieldName) throws ReflectiveOperationException {
		Field field = o.getClass().getDeclaredField(fieldName);
		field.setAccessible(true);
		return (T) field.get(o);
	}

	private <T> T accessSuperClassPrivateField(Object o, String fieldName) throws ReflectiveOperationException {
		Field field = o.getClass().getSuperclass().getDeclaredField(fieldName);
		field.setAccessible(true);
		return (T) field.get(o);
	}

   // ê³µí†µ ì‚¬ìš©ë  simpleStepBuilder ë§Œë“¤ê¸°
	@BeforeEach
	void set(){
		StepBuilderHelper stepBuilderHelper = new StepBuilderHelper("test", jobRepository) {
			@Override
			protected StepBuilderHelper self() {
				return null;
			}
		};
		simpleStepBuilder = new SimpleStepBuilder(stepBuilderHelper);
		simpleStepBuilder.chunk(chunkSize);
		simpleStepBuilder.reader(itemReader);
		simpleStepBuilder.processor(itemProcessor);
		simpleStepBuilder.writer(itemWriter);
	}

    // ë³µì‚¬ê°€ ì˜ë˜ëŠ”ì§€ í™•ì¸
	@Test
	void copyConstractorTest() throws ReflectiveOperationException {
		Constructor<SimpleStepBuilder> constructor = SimpleStepBuilder.class.getDeclaredConstructor(SimpleStepBuilder.class);
		constructor.setAccessible(true);
		SimpleStepBuilder copySimpleStepBuilder = constructor.newInstance(simpleStepBuilder);

		int copyChunkSize = accessPrivateField(copySimpleStepBuilder, "chunkSize");
		ItemReader copyItemReader = accessPrivateField(copySimpleStepBuilder, "reader");
		ItemProcessor copyItemProcessor = accessPrivateField(copySimpleStepBuilder, "processor");
		ItemWriter copyItemWriter = accessPrivateField(copySimpleStepBuilder, "writer");

		assertEquals(chunkSize, copyChunkSize);
		assertEquals(itemReader, copyItemReader);
		assertEquals(itemProcessor, copyItemProcessor);
		assertEquals(itemWriter, copyItemWriter);
	}

   // taskExecutorë¥¼ ë¨¼ì €í•˜ê³  faultTolerantë¥¼ ì´í›„ì— í–ˆì„ ë•Œ ê°’ ë¹„êµ
	@Test
	void faultTolerantMethodTest() throws ReflectiveOperationException {
		simpleStepBuilder.taskExecutor(taskExecutor); // The task executor is set before faultTolerant()
		simpleStepBuilder.faultTolerant();

		int afterChunkSize = accessPrivateField(simpleStepBuilder, "chunkSize");
		ItemReader afterItemReader = accessPrivateField(simpleStepBuilder, "reader");
		ItemProcessor afterItemProcessor = accessPrivateField(simpleStepBuilder, "processor");
		ItemWriter afterItemWriter = accessPrivateField(simpleStepBuilder, "writer");
		TaskExecutor afterTaskExecutor = accessSuperClassPrivateField(simpleStepBuilder, "taskExecutor");

		assertEquals(chunkSize, afterChunkSize);
		assertEquals(itemReader, afterItemReader);
		assertEquals(itemProcessor, afterItemProcessor);
		assertEquals(itemWriter, afterItemWriter);
		assertEquals(taskExecutor, afterTaskExecutor);
	}
}
```

##### ìŠ¤í„°ë”” íšŒê³ 
ì‹¤ì œë¡œ ì˜¤í”ˆì†ŒìŠ¤ì— ê¸°ì—¬í•œë‹¤ëŠ” ê±´ ìƒê°ë§Œ í•´ë³´ê³  ì‹œë„í•œ ì ì´ ì—†ì—ˆëŠ”ë° ì´ë ‡ê²Œ ê°„ë‹¨í•œ ì˜¤í”ˆì†ŒìŠ¤ë¥¼ í†µí•´ ì´ë²ˆì„ ì‹œì‘ìœ¼ë¡œ ë‹¤ë¥¸ ì˜¤í”ˆì†ŒìŠ¤ì—ë„ ì°¸ì—¬í•´ë³´ê³  ì‹¶ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ì˜¤í”ˆì†ŒìŠ¤ ìì²´ì— ëŒ€í•œ ì‹¬ë¦¬ì  ë¶€ë‹´ê°?ê°™ì€ ê²ƒì´ ìˆì—ˆëŠ”ë° ì‹¤ì œë¡œ í”„ë¡œì íŠ¸ì— ì°¸ì—¬í•˜ë“¯ì´ ê¸°ì—¬ë¥¼ í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ ì¢‹ì•˜ìŠµë‹ˆë‹¤.
ìŠ¤í„°ë””ê°€ ì•„ë‹ˆì˜€ìœ¼ë©´, ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ í•¨ê»˜ í•˜ì§€ ì•Šì•˜ìœ¼ë©´ ì‹œë„ê°€ ë” ëŠ¦ì–´ì¡Œì„ ê²ƒ ê°™ì€ë° ì¢‹ì€ ê¸°íšŒì— ì°¸ì—¬í•  ìˆ˜ ìˆì–´ì„œ ê°ì‚¬í–ˆìŠµë‹ˆë‹¤.  

ê²°ë¡ ìœ¼ë¡œ ```spring-batch```ëŠ” ê¸°ì—¬í•  ê²ƒì´ ë§ì€ ë…¸ë‹¤ì§€ì˜€ë‹¤!

<p style="text-align: center; margin: 50px 0">
    <img src="/assets/gitbook/post_images/spring/opensource-study-result.png" style="width: 80%"/>
</p>

<span style="background-color:#fff5b1">ìŠ¤í”„ë§ ë°°ì¹˜ ì»¨íŠ¸ë¦¬ë·°í„°!!</span>  
ê·¸ë¡œë¶€í„° ê±°ì˜ 5ê°œì›”ì´ ì§€ë‚œ ì‹œì ì˜ ë©”ì¸í…Œì´ë„ˆì˜ í”¼ë“œë°±ì„ ë°›ê²Œ ëëŠ”ë° ë„ì›€ì„ ì£¼ì‹  ì¸ì œë‹˜ê³¼ ê¸°ì—¬ë¶€ë¶„ ìˆ˜ì •ì œì•ˆì„ í•´ì£¼ì‹  íƒœìµë‹˜ì˜ ë„ì›€ìœ¼ë¡œ prì„ ë‹¤ì‹œ ì˜¬ë ¤ì„œ close ì‹œí‚¬ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.  
ì‚¬ì‹¤ ì—„ì²­ë‚œ ì½”ë“œì‘ì„±ì„ í•œ ë¶€ë¶„ì€ ì•„ë‹ˆì§€ë§Œ ì¤‘ê°„ ë°ì´í„° ì†Œì‹¤ì´ë¼ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ëŠ” ë¶€ë¶„ì´ê¸° ë•Œë¬¸ì— coreë‹¨ ë²„ê·¸ë¥¼ ìˆ˜ì •í–ˆë‹¤ëŠ” ì ì—ì„œ êµ‰ì¥íˆ ë¿Œë“¯í–ˆê³ , ì´ëŸ° ì‹ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆêµ¬ë‚˜ ì´ë ‡ê²Œ ì†Œí†µí•´ì„œ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ”êµ¬ë‚˜ë¼ëŠ” ê²ƒì„
ì•Œê²Œ ëœ ìˆœê°„ì´ì—ˆìŠµë‹ˆë‹¤.

ì•„ì‰¬ìš´ ë¶€ë¶„ì´ ìˆë‹¤ë©´, ì•„ë¬´ë¦¬ ìƒê°í•´ë„ ë‹¹ì‹œì— ì´ìŠˆì—ì„œ ì œì•ˆí•œ í•œì •ì  ë°©ë²• ë°–ì— ë– ì˜¤ë¥´ì§€ ì•Šì•„ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ì¼ë‹¨ ì´ìŠˆëŒ€ë¡œ ì‘ì„±í–ˆì—ˆìŠµë‹ˆë‹¤. ì¤‘ê°„ì— test ë¶€ë¶„ ì‘ì„±ì— ëŒ€í•œ ë°©í–¥ì„±ì„ ë” ìœ ì§€ë³´ìˆ˜ê°€ ì‰½ê²Œ í•˜ëŠ” ë°©ì•ˆìœ¼ë¡œ ë©”ì¸í…Œì´ë„ˆ ìš”ì²­ì„ ë§Œì¡±ìŠ¤ëŸ½ê²Œ ìˆ˜ì •í•˜ì§€ ëª»í•œ ë¶€ë¶„ì´ì—ˆìŠµë‹ˆë‹¤.
ê¸°ì¡´ì—ëŠ” ëª¨ë“  ê°’ë“¤ì´ ì˜ ë³µì‚¬ëëŠ”ì§€ í™•ì¸í•˜ëŠ” ë°©ì‹ì´ì—ˆëŠ”ë°, ë©”ì¸í…Œì´ë„ˆê°€ ì•„ë˜ì™€ ê°™ì´ `stepOperations` ë¹„êµë¥¼ í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë³€ê²½í•´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ë³€ê²½í•´ì£¼ì‹ ê±¸ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
(spring-batchì—ëŠ” `private` ì²˜ë¦¬ëœ ê²ƒì´ ë§ì•„ì„œ `ReflectionTestUtils`ë¡œ ê°’ì„ ê·¸ëƒ¥ ê°€ì§€ê³  ì™€ì„œ ë¹„êµí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ì‹¤ì œë¡œ ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ì—ë„ ì‘ì„±ëœ ë¶€ë¶„ì´ ë§ìŠµë‹ˆë‹¤.)
```java
Object stepOperations = ReflectionTestUtils.getField(step, "stepOperations");
assertInstanceOf(TaskExecutorRepeatTemplate.class, stepOperations);
```

<br><br>

## ğŸš´ğŸ½ ë‚´ Github action unit-testëŠ” ì™œ ì•ˆ í†µê³¼í–ˆì„ê¹Œ?
**ë¬¸ì œë°œìƒ**  
ë¡œì»¬ì—ì„œëŠ” ë¬¸ì œê°€ ì—†ì—ˆëŠ”ë° Github action pr testë¥¼ í†µê³¼í•˜ì§€ ëª»í•˜ëŠ” ìƒí™©ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¹ì‹œ prì— ë§ì€ ê¸°ëŠ¥ì˜ commitì´ ìˆì–´ì„œ í•˜ë‚˜ì”© ì‚´í´ë´¤ì§€ë§Œ testê°€ ì„±ê³µí•˜ì§€ ëª»í•˜ëŠ” ì´ìœ ë¥¼ ì•Œì§€ ëª»í•´ì„œ íŒ€ì›ë“¤ê³¼ ê°™ì´ ë…¼ì˜í•˜ë©´ì„œ í•´ê²°í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. 

![20231003_150719.png](/assets/gitbook/post_images/spring/20231003_150719.png)

<br>

**ë¬¸ì œì›ì¸ íŒŒì•…í•˜ê¸°**  
propertiesê°€ ì˜ ë§¤í•‘ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ë‚˜ëŠ” ì—ëŸ¬ì˜€ê³  ```.env```, ```application.yml``` ë“± mapping íŒŒì¼ë“¤ì„ ì‚´í´ë³´ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.
```
DevMingleApplicationTest > contextLoads() FAILED
    java.lang.IllegalStateException at DefaultCacheAwareContextLoaderDelegate.java:143
        Caused by: org.springframework.beans.factory.BeanCreationException at AutowiredAnnotationBeanPostProcessor.java:489
            Caused by: java.lang.IllegalArgumentException at PropertyPlaceholderHelper.java:18***
OpenJDK 64-Bit Server VM warning: Sharing is only supported for boot loader classes because bootstrap classpath has been appended
2***23-1***-***3T***4:55:***5.188Z  INFO 192*** --- [ionShutdownHook] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
```

<br>

**í•´ê²°ë°©ì•ˆ**  
íŒ€ íšŒì˜ ë•Œ ê°™ì´ ì‚´í´ë³¸ ê²°ê³¼ testì— ìˆëŠ” ```application.yml```ì— ```include```ì²˜ë¦¬ë¡œ ë‹¤ë¥¸ mapping íŒŒì¼ì„ ì¶”ê°€í•˜ì§€ ì•Šì•„ ë°œìƒí•œ ë¬¸ì œì˜€ìŠµë‹ˆë‹¤.  
ê²°ê³¼ì ìœ¼ë¡œ ìƒˆë¡œ ì´ë²ˆì— commití•˜ë©´ì„œ ìƒì„±ëœ ```valid``` mappingì„ ì¶”ê°€í•˜ë¯€ë¡œì„œ í•´ê²°í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
```yml
spring:
  profiles:
    include: auth, valid
```

<br>

**ì¶”ê°€ ê³ ì°°í•˜ê¸°**  
Github actionì— testë¥¼ í†µê³¼í•˜ëŠ”ì§€ ì‚´í´ë³´ê¸° ìœ„í•´ì„œëŠ” test ì½”ë“œ ë¹Œë“œì—¬ë¶€ë¥¼ í™•ì¸í•´ì•¼ í•˜ê³ , ê·¸ ê³¼ì •ì—ì„œ ì†ì„±ê°’ ë§¤í•‘ì´ ì œëŒ€ë¡œ ë˜ëŠ”ì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.
ì•Œê³ ë³´ë‹ˆ ì‚¬ì‹¤ ê°„ë‹¨í•œ ì†”ë£¨ì…˜ì´ì—ˆì§€ë§Œ ì´ ê¸€ì„ ë‚¨ê¸°ëŠ” ì´ìœ ëŠ” ê°„ë‹¨í•´ë„ ê¸°ì–µí•˜ì§€ ëª»í•˜ê±°ë‚˜ ê²½í—˜í•˜ì§€ ì•Šì•˜ì„ ë•Œ, ê°„ê³¼í•  ìˆ˜ ìˆëŠ” ë¶€ë¶„ì´ë¼ ìƒê°ì´ ë“¤ì—ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
ê·¸ë¦¬ê³  ì € í˜¼ì ë³´ì´ì§€ ì•Šë˜ ë¶€ë¶„ì„ íŒ€ì›ë“¤ê³¼ í•´ê²°í•  ìˆ˜ ìˆì–´ì„œ ë¿Œë“¯í–ˆìŠµë‹ˆë‹¤ :)

<br><br>

## ğŸš´ğŸ½ @Password ì‚¬ìš©ì ì •ì˜ ì–´ë…¸í…Œì´ì…˜ ìƒì„±ê³¼ yml ì†ì„± mapping error í•´ê²°í•˜ê¸°

**ë¬¸ì œë°œìƒ**  
ìœ íš¨ì„± ê²€ì¦ì„ ìœ„í•´ ì–´ë…¸í…Œì´ì…˜ì„ ìƒì„±í•˜ê³  ì—ëŸ¬ë©”ì„¸ì§€ì™€ patternì„ mappingí•˜ëŠ” ê³¼ì •ì—ì„œ yml ê°’ì´ ì œëŒ€ë¡œ ì—°ê²°ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
```
10:35:32.622 [restartedMain] ERROR org.springframework.boot.SpringApplication -- Application run failed java.lang.NullPointerException: Cannot invoke "Object.toString()" because "key" is null at org.springframework.beans.factory.config.YamlProcessor.lambda$asMap$0(YamlProcessor.java:248) at java.base/java.util.LinkedHashMap.forEach(LinkedHashMap.java:721) at org.springframework.beans.factory.config.YamlProcessor.asMap(YamlProcessor.java:239) at org.springframework.beans.factory.config.YamlProcessor.lambda$asMap$0(YamlProcessor.java:241) at java.base/java.util.LinkedHashMap.forEach(LinkedHashMap.java:721) at org.springframework.beans.factory.config.YamlProcessor.asMap(YamlProcessor.java:239) at org.springframework.beans.factory.config.YamlProcessor.lambda$asMap$0(YamlProcessor.java:241) at java.base/java.util.LinkedHashMap.forEach(LinkedHashMap.java:721)
```

application-valid.yml
```yml
valid:  
  password:  
    pattern: ^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@#$%^&+=!])(?=\\S+$).{8,}$
    message:
      null: ë¹„ë°€ë²ˆí˜¸ëŠ” ê³µë°±ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.  
      err: ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 8ì ì´ìƒ, ì˜ë¬¸ ëŒ€ì†Œë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ ë¬¸ì í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.
```

PasswordValidator.java
```java
package com.example.dm.dto.users;  
  
import jakarta.annotation.PostConstruct;  
import jakarta.validation.ConstraintValidator;  
import jakarta.validation.ConstraintValidatorContext;  
import org.slf4j.Logger;  
import org.slf4j.LoggerFactory;  
import org.springframework.beans.factory.annotation.Value;  
import org.springframework.stereotype.Component;  
  
@Component  
class PasswordValidator implements ConstraintValidator<Password, String> {  
  @Value("${valid.password.pattern}")  
  private String PASSWORD_PATTERN;  
  @Value("${valid.password.message.null}")  
  private String PASSWORD_NULL_MESSAGE;  
  @Value("${valid.password.message.err}")  
  private String PASSWORD_ERR_MESSAGE;
    
  @Override  
  public boolean isValid(String value, ConstraintValidatorContext context) {  
      if(value.isBlank()){  
          context.disableDefaultConstraintViolation();  
          context.buildConstraintViolationWithTemplate(PASSWORD_NULL_MESSAGE)  
          .addConstraintViolation();  
          return false;  
      }else if(!value.matches(PASSWORD_PATTERN)){  
          context.disableDefaultConstraintViolation();  
          context.buildConstraintViolationWithTemplate(PASSWORD_ERR_MESSAGE)  
          .addConstraintViolation();  
          return false;  
      }  
      return true;  
      }  
  }
}
```

<br>

**ë¬¸ì œì›ì¸ íŒŒì•…í•˜ê¸°**
1. .yml ê°’ ë“±ë¡ì´ ë°”ë¥´ê²Œ ë“¤ì–´ì˜¤ëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.
2. PasswordValidator í´ë˜ìŠ¤ëŠ” @Component ì„¤ì •ëœ ìƒíƒœì…ë‹ˆë‹¤.
3. ì—ëŸ¬ ë””ë²„ê¹… ```YamlProcessor``` ì°ì–´ë³´ê¸°

<br>

**í•´ê²°ë°©ì•ˆ**  
```YamlProcessor```ì—ì„œ ì°ì–´ë´¤ì„ ë•Œ, key ê°’ì´ nullì´ê³  valueëŠ” ì œëŒ€ë¡œ ë“¤ì–´ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. 
value ê°’ì˜ ë¬¸ìì—´ ì²˜ë¦¬ ì´í›„ì—ë„ ë¬¸ì œê°€ ë°œìƒí•´ì„œ ë””ë²„ê¹… í•´ë³¸ ê²°ê³¼, yml íŒŒì¼ì— key ê°’ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ì—†ëŠ” ì˜ˆì•½ì–´ ```null```ì´ ì‚¬ìš©ëœ ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
ymlì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ì˜ˆì•½ì–´ë¡œëŠ” ```y```,```yes```,```n```,```no```,```true```,```false```,```null```,```~``` ë“±ì´ ìˆìŠµë‹ˆë‹¤.

<br>

**ì¶”ê°€ ê³ ì°°í•˜ê¸°**  
ì¶”ê°€ì ìœ¼ë¡œ @Value ê°’ì´ ì œëŒ€ë¡œ ë“¤ì–´ì˜¤ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ ```@PostConstruct```ë¡œ ê°’ì„ ì°ì–´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
í•˜ì§€ë§Œ ìœ„ì—ì„œ ë¬¸ì œëŠ” ```@PostConstruct```ëŠ” í™•ì¸ì´ ë¶ˆê°€ëŠ¥í–ˆëŠ”ë°, ìŠ¤í”„ë§ ë¹ˆì´ ìƒì„±ë˜ê³  ëª¨ë“  ì˜ì¡´ì„± ì£¼ì… ì™„ë£Œ í›„ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ìœ„ì— ì—ëŸ¬ëŠ” ì„¤ì •íŒŒì¼ì´ë‚˜ ì´ˆê¸°í™” ë‹¨ê³„ì˜ ë¬¸ì œì´ê¸° ë•Œë¬¸ì—
ë¹ˆì˜ ë©”ì„œë“œ ì‹¤í–‰ ì „ì´ë¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤íŒ¨ë¡œ ë¯¸ë¦¬ ì¢…ë£Œë˜ì–´ ë²„ë ¸ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ ê²½ìš°ëŠ” ë‹¨ìˆœí•˜ê²Œ yml íŒŒì¼ ì„¤ì •ì„ í™•ì¸í•  í•„ìš”ê°€ ìˆìŒì„ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.
```java
private static final Logger logger = LoggerFactory.getLogger(PasswordValidator.class);

@PostConstruct  
public void postConstruct() {  
	logger.info("PASSWORD_PATTERN: {}", PASSWORD_PATTERN);  
	logger.info("PASSWORD_NULL_MESSAGE: {}", PASSWORD_NULL_MESSAGE);  
	logger.info("PASSWORD_ERR_MESSAGE: {}", PASSWORD_ERR_MESSAGE);  
}  
```

<br><br>



## ğŸš´ğŸ½ ì•”í˜¸í™”ì™€ authentication ì´ìŠˆ
> Spring boot 3.x, Spring security 6, Java 17

<br>

**ì´ìŠˆì‚¬í•­**  
Spring security ì„¤ì •ìœ¼ë¡œ ```defaultSuccessUrl```ë¡œ ì˜ ì´ë™í•˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì˜€ìœ¼ë‚˜ ì‹¤ì œë¡œ ```SecurityContextHolder```ì— ì œëŒ€ë¡œ authenticationì´ ë“±ë¡ë˜ì§€ ì•Šì•„ì„œ ë·°ë‹¨ì—ì„œ thymeleaf ```sec:authorize``` ì„¤ì •ì´ ì œëŒ€ë¡œ ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í•´ê²°ë°©ë²•ì€ ê°„ë‹¨í–ˆì§€ë§Œ ë‹¹ì‹œì— ë³„ë‹¤ë¥¸ ì—ëŸ¬ ë¬¸êµ¬ê°€ ì—†ì–´ ê³ ë¯¼í•œ ë¶€ë¶„ë“¤ì„ ì •ë¦¬í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.

<br>

**ì‹œë„í•œ ë°©ë²•ë“¤**  
ë¨¼ì €, ì˜ì¡´ì„± ë¬¸ì œê°€ ì•„ë‹ê¹Œ ê³ ë¯¼í–ˆìŠµë‹ˆë‹¤. Spring boot 3.xì™€ ì¼ë¶€ ì˜ì¡´ì„± ì¶©ëŒ ê°€ëŠ¥ì„±ì— ëŒ€í•œ ê¸€ì„ ì½ì€ ê¸°ì–µì´ ìˆì–´ì„œ ì°¾ì•„ë´¤ëŠ”ë° ê³µì‹ ë ˆí¼ëŸ°ìŠ¤ì—ì„œë„ ```thymeleaf-extras-springsecurity6```ì™€ ì´ìŠˆê°€ ìˆë‹¤ëŠ” ë“±ì˜ ê´€ë ¨ëœ ë³„ë‹¤ë¥¸ ì ‘ì ì€ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.  
```SecurityContextHolder```ì—ì„œ authenticationì„ ì œëŒ€ë¡œ ë‹´ì§€ ëª»í•˜ê³  ìˆëŠ” ê²ƒì´ ì•„ë‹ê¹Œ ìƒê°í•´ì„œ debugë¥¼ í•˜ë©´ì„œ ì½”ë“œë¥¼ ì°¾ì•„ë´¤ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ëª…ì‹œì ìœ¼ë¡œ ```SecurityContextHolder```ì— ```authentication```ì„ ë„£ì–´ë„ ê°’ì´ ```anomyous authentication```ìœ¼ë¡œ ì°íˆëŠ” ê²ƒì„ ë³´ì•˜ìŠµë‹ˆë‹¤. ì´ ë¶€ë¶„ì€ ìš”ì²­ì„ ìˆ˜í–‰ í›„ ìë™ìœ¼ë¡œ ```filterChainProxy```ì—ì„œ ```doFilter```ì—ì„œ ```this.securityContextHolderStrategy.clearContext();```ì²˜ë¦¬í•´ì„œì˜ ë¬¸ì œê°€ ì•„ë‹ˆì˜€ë‹¤ëŠ” ê²ƒì„ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.
```java
@Override
public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
        throws IOException, ServletException {
    boolean clearContext = request.getAttribute(FILTER_APPLIED) == null;
    if (!clearContext) {
        doFilterInternal(request, response, chain);
        return;
    }
    try {
        request.setAttribute(FILTER_APPLIED, Boolean.TRUE);
        doFilterInternal(request, response, chain);
    }
    catch (Exception ex) {
        Throwable[] causeChain = this.throwableAnalyzer.determineCauseChain(ex);
        Throwable requestRejectedException = this.throwableAnalyzer
                .getFirstThrowableOfType(RequestRejectedException.class, causeChain);
        if (!(requestRejectedException instanceof RequestRejectedException)) {
            throw ex;
        }
        this.requestRejectedHandler.handle((HttpServletRequest) request, (HttpServletResponse) response,
                (RequestRejectedException) requestRejectedException);
    }
    finally {
        this.securityContextHolderStrategy.clearContext();
        request.removeAttribute(FILTER_APPLIED);
    }
}
```  

<br>

**í•´ê²°ë°©ì•ˆ**  
ì´ˆì‹¬ìœ¼ë¡œ ëŒì•„ê°€ì„œ ì¤‘ìš”í•˜ê²Œ ë‹¤ì‹œ ìƒê°í•´ë³´ê²Œ ëœ ë¶€ë¶„ì´ Spring securityì˜ ë™ì‘ì›ë¦¬ì˜€ìŠµë‹ˆë‹¤. filter ì¤‘ì‹¬ì˜ Spring security í”„ë¡œì„¸ìŠ¤ì—ì„œ ì¸ì¦ë…¼ë¦¬ êµ¬ì¡°ë¥¼ ë³´ë©´ ```UserDetailService```ë¡œ user ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê³ , ì´ ë•Œ ì¸ì¦ì€ ```AuthenticationProvider```ë¼ëŠ” ì¸ì¦ ì œê³µìë¥¼ í†µí•´ì„œ ì§„í–‰ë©ë‹ˆë‹¤.
ì´ë¥¼ ìœ„í•´ ```SecurityConfig```ì— ë¹ˆìœ¼ë¡œ ì£¼ì…í•´ì„œ authenticationì´ ë°”ë¥´ê²Œ ì ìš©ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
```java
@Bean
public DaoAuthenticationProvider daoAuthenticationProvider(){
    DaoAuthenticationProvider daoAuthenticationProvider = new DaoAuthenticationProvider();
    daoAuthenticationProvider.setPasswordEncoder(passwordEncoder());
    daoAuthenticationProvider.setUserDetailsService(authService);
    return daoAuthenticationProvider;
}
```

<br>

**ì¶”ê°€ ê³ ì°°**  
ì´ì „ í”„ë¡œì íŠ¸ì—ì„œëŠ” Spring securityì—ì„œ ë³„ë„ì˜ ì¸ì¦ì œê³µìë¥¼ ë¹ˆìœ¼ë¡œ ì£¼ì…í•˜ì§€ ì•Šì•„ë„ ì‘ë™í–ˆì—ˆëŠ”ë°, ì˜¤ë˜ëœ ë²„ì „ì´ë¼ì„œ ```WebSecurityConfigurerAdapter```ë¥¼ í†µí•œ override ë°©ì‹ì˜ êµ¬í˜„ì´ì—ˆë‹¤ëŠ” ì ì´ ê°€ì¥ í° ì°¨ì´ì˜€ìŠµë‹ˆë‹¤.
version 5.4 ì´í›„ë¶€í„°ëŠ” ```component-based``` ë°©ì‹ìœ¼ë¡œ ì ‘ê·¼í•˜ê¸° ë•Œë¬¸ì— ë‹¬ë¼ì§„ ë¶€ë¶„ì´ ìˆìŠµë‹ˆë‹¤. filterChain ë°©ì‹ì˜ êµ¬í˜„ê³¼ í•„ìš”í•œ ë…¼ë¦¬ë¶€ë¥¼ ë¹ˆ ë˜ëŠ” ì»´í¬ë„ŒíŠ¸í™”í•´ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤.  
ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  ì´ë²ˆ ì´ìŠˆëŠ” ë‹¨ìˆœíˆ ```WebSecurityConfigurerAdapter```ê°€ deprecated ë˜ì—ˆê¸° ë•Œë¬¸ì´ë¼ê³ ë§Œì€ ë³¼ ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.

![20230706_194429.png](/assets/gitbook/post_images/issue/20230706_194429.png)

ì—¬ê¸°ì„œ ë³´ë©´, AuthenticationManagerë¡œì„œ ```ProviderManager```ëŠ” ```DaoAuthenticationProvider```ë¥¼ default ê°’ìœ¼ë¡œ ì œê³µí•˜ê³  ìˆëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ìœ„ í•´ê²°ë°©ì•ˆì—ì„œ @Bean ì£¼ì… ì´í›„ ```DaoAuthenticationProvider```ì˜ authentication ê³¼ì •ì´ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

<br>

**ê²°ê³¼**  
authenication ê³¼ì •ì´ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆê³ , ë·°ë‹¨ì—ì„œ securityContextì— ë”°ë¥¸ ```sec:authorize```ê°€ ì˜ ì‘ë™í•´ ë¡œê·¸ì¸í•œ ê²½ìš°ì—ëŠ” ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ì´ ë³´ì´ê²Œ ë™ì‘í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

<br><br>

## Spring Triangle
> IoC, AOP, PSA

<br>

**ì˜ì¡´ì„± ì£¼ì…ê³¼ ì œì–´ì—­ì „, IoC(Inversion of Control)**
```java
// ì‚¬ìš©í•  ì˜ì¡´ì„±ì„ ì™¸ë¶€ì—ì„œ ë§Œë“¤ì–´ì£¼ëŠ” ê°œë…ì´ ë°”ë¡œ IoCì´ë‹¤.
class OwnerController {
   private OwnerRepository repository = new OwnerRepository();
}
```
<span style="background-color:#fff5b1">ì˜ì¡´ì„±ì„ ì£¼ì…í•´ì£¼ëŠ” ì¼ì„ ì™¸ë¶€ì—ì„œ í•´ì£¼ëŠ” ê²ƒì„ IoC ë¼ê³  í•©ë‹ˆë‹¤.</span> IoC ì»¨í…Œì´ë„ˆëŠ” ```Application Context```ì™€ ```BeanFactory``` ì¸í„°í˜ì´ìŠ¤ë¥¼ ì´ìš©í•´ ë¹ˆì„ ë§Œë“¤ê³  ë¹ˆë“¤ ì‚¬ì´ì˜ ì˜ì¡´ì„±ì„ ì œê³µí•´ì¤ë‹ˆë‹¤. ë¹ˆì˜ ìƒì„±ì€ ì»¨í…Œì´ë„ˆê°€ ë§Œë“¤ì–´ì§ˆ ë•Œ ```component scanning``` ê³¼ì •ìœ¼ë¡œ ```@Component``` ì´í•˜ ê°’ë“¤ì„ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì¤ë‹ˆë‹¤.  
ì—¬ê¸°ì„œ ```ë¹ˆ(Bean)```ì´ë€ ìŠ¤í”„ë§ IoC ì»¨í…Œì´ë„ˆê°€ ê´€ë¦¬í•˜ëŠ” ê°ì²´ë¥¼ ë§í•©ë‹ˆë‹¤. ```applicationContext.getBean()``` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ìŠ¤í”„ë§ì— ë“±ë¡ëœ ëª¨ë“  ë¹ˆì˜ ì´ë¦„ë“¤ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
<span style="background-color:#DCFFE4">ê·¸ëŸ¼ @Autowired, @Inject ì°¨ì´ì ì€ ë¬´ì—‡ì¼ê¹Œ?</span>  
ë“±ë¡ëœ ë¹ˆë“¤ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ë©°, ì„œë¡œ ëŒ€ì²´ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì´ ì–´ë…¸í…Œì´ì…˜ë“¤ì„ ì‚¬ìš©í•  ë•ŒëŠ” <span style="background-color:#fff5b1">ìƒì„±ìì— ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê¶Œì¥</span>ë©ë‹ˆë‹¤. <span style="background-color:#fff5b1">@AutowiredëŠ” Spring</span>ì—ì„œ ì§€ì›í•˜ëŠ” í”„ë ˆì„ì›Œí¬ì— ì¢…ì†ì ì¸ ì–´ë…¸í…Œì´ì…˜ì´ê³ , <span style="background-color:#fff5b1">@InjectëŠ” Java</span>ì—ì„œ ì§€ì›í•˜ëŠ” ê²ƒì´ë©°, nullableí•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë°˜ë“œì‹œ ì£¼ì…ë°›ì„ ë¹ˆì´ í•„ìš”í•©ë‹ˆë‹¤.

<br>

**ê´€ì  ì§€í–¥ í”„ë¡œê·¸ë˜ë°, AOP(Aspect Oriented Programming)**  
<span style="background-color:#fff5b1">ê´€ì‹¬ì‚¬ë¥¼ ì¤‘ì ìœ¼ë¡œ ì¤‘ë³µëœ ì½”ë“œë¥¼ ëª¨ì•„ì„œ íš¡ë‹¨ ê´€ì‹¬ì‚¬ì˜ ì²˜ë¦¬ë¥¼ í•˜ëŠ” í”„ë¡œê·¸ë˜ë° ê¸°ë²•</span>ì„ ë§í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë©”ì„œë“œë³„ ì„±ëŠ¥ì„ ì¬ê¸° ìœ„í•´ì„œ ì‚¬ìš©í•˜ëŠ” ```org.springframework.util.StopWatch``` ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì—ì„œ ì œê³µí•˜ëŠ” ìœ í‹¸ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ë°, ì´ëŸ° ê³µí†µê¸°ëŠ¥ë“¤ì„ ëª¨ë“  ë©”ì„œë“œ ì‹¤í–‰ ì „ ìˆ˜í–‰í•˜ê³  ì‹œê°„ì„ ì¸¡ì •í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ AOPë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.    
AOPë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì€ AspectJë¥¼ ì´ìš©í•œ ì»´íŒŒì¼ì„ ì´ìš©í•˜ê±°ë‚˜ ë°”ì´íŠ¸ ì½”ë“œë¥¼ ì¡°ì‘í•˜ê±°ë‚˜ í”„ë¡ì‹œ íŒ¨í„´ì„ ì´ìš©í•˜ëŠ” ë°©ë²•ë“¤ì´ ìˆìŠµë‹ˆë‹¤. ê·¸ ì¤‘ì—ì„œë„ ìŠ¤í”„ë§ì€ í”„ë¡ì‹œ íŒ¨í„´ì„ ì´ìš©í•´ì„œ AOPë¥¼ ì§€ì›í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì‹¤ì œ ë””ìì¸íŒ¨í„´ì—ì„œ ë§í•˜ëŠ” í”„ë¡ì‹œ íŒ¨í„´ê³¼ ì¡°ê¸ˆ ìƒì´í•œë°, ë¦¬í”Œë ‰ì…˜ê³¼ ë°”ì´íŠ¸ì½”ë“œ ì¡°ì‘ì„ ì´ìš©í•´ ì‹¤ì œ íƒ€ê²Ÿ ê¸°ëŠ¥ì„ ëŒ€ë¦¬ ìˆ˜í–‰í•˜ë©°, ê¸°ëŠ¥ì„ í™•ì¥í•˜ê±°ë‚˜ ì¶”ê°€í•  ìˆ˜ ìˆëŠ” <span style="background-color:#fff5b1">ë‹¤ì´ë‚˜ë¯¹ í”„ë¡ì‹œ ê°ì²´</span>ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
```java
// ìŠ¤í”„ë§ AOP ì²˜ë¦¬ ì˜ˆì œ ì½”ë“œ
@Component
@Aspect
public class LogAspect {
  Logger logger = LoggerFactory.getLogger(LogAspect.class);

  @Around("@annotation(LogExecutionTime)")
  public Object logExecutionTime(ProceedingJoinPoint joinPoint) throws Throwable{
    StopWatch stopWatch = new StopWatch();
    stopWatch.start();

    Object proceed = joinPoint.proceed();

    stopWatch.stop();
    logger.info(stopWatch.prettyPrint());

    return proceed;
  }
}
```


<details>
<summary><span style="background-color:#f0f0f0; cursor:pointer;">ğŸ” AspectJë¥¼ ì´ìš©í•œ ì»´íŒŒì¼ê³¼ ë°”ì´íŠ¸ ì½”ë“œ ì¡°ì‘ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•˜ëŠ” AOP</span></summary>  

ì»´íŒŒì¼ ë°©ì‹ <br>
A.java - (AOP) - A.class(AspectJ)  <br>
ë°”ì´íŠ¸ì½”ë“œ ì¡°ì‘ <br>
A.java - A.class - (AOP) - ë©”ëª¨ë¦¬(AspectJ)

</details>

<br>

**ì¶”ìƒí™” ì„œë¹„ìŠ¤, PSA(Portable Service Abstraction)**  
ì˜ ë§Œë“  ì¸í„°í˜ì´ìŠ¤. <span style="background-color:#fff5b1">í™˜ê²½ ë³€í™”ì™€ ê´€ê³„ì—†ì´ ì¼ê´€ëœ ë°©ì‹ì˜ ê¸°ìˆ ë¡œì˜ ì ‘ê·¼ í™˜ê²½ì„ ì œê³µí•˜ëŠ” ì¶”ìƒí™” êµ¬ì¡°</span>ë¥¼ ë§í•©ë‹ˆë‹¤. Springì—ì„œëŠ” Spring Web MVC, Spring Transaction, Spring Cache ë“± ë‹¤ì–‘í•œ PSAë¥¼ ì œê³µí•©ë‹ˆë‹¤. Spring MVCë¥¼ ì‚¬ìš©í•˜ë©´ @Controller, @RequestMapping ë“±ì˜ ê¸°ëŠ¥ì„ ê¸°ì¡´ ì½”ë“œ ë³€ë™ì—†ì´ ê°„ë‹¨í•˜ê²Œ ì½”ë“œ ë³€ê²½ì´ ê°€ëŠ¥í•œ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ ì¼ê´€ì„± ìˆëŠ” ì„œë¹„ìŠ¤ ì¶”ìƒí™”(Service Abstraction)ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
+ í”„ë¡œì íŠ¸ì˜ ```spring-boot-starter-web``` ì˜ì¡´ì„± ëŒ€ì‹  ```spring-boot-starter-webflux``` ì˜ì¡´ì„±ì„ ë°›ë„ë¡ ë°”ê¿”ì£¼ê¸°ë§Œ í•˜ë©´ ```Tomcat```ì´ ì•„ë‹Œ ```netty``` ê¸°ë°˜ìœ¼ë¡œ ì‹¤í–‰í•˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<hr/>

[ì˜ˆì œë¡œ ë°°ìš°ëŠ” ìŠ¤í”„ë§ ì…ë¬¸](https://www.inflearn.com/course/spring_revised_edition#)  
[Inversion of Control Containers and the Dependency Injection pattern](https://martinfowler.com/articles/injection.html)
[Proxy](https://refactoring.guru/design-patterns/proxy)

<br><br>

## ì—”í‹°í‹° ì„¤ê³„ì‹œ ì£¼ì˜ì 
**ì—¬ê¸°ì €ê¸° ```@Setter``` ê¸ˆì§€**  
ì—”í‹°í‹°ì—ì„œëŠ” ê°€ê¸‰ì  ```Setter```ë¥¼ ì‚¬ìš©í•˜ì§€ ë§ê³  í•„ìš”í•œ ë¶€ë¶„ì—ëŠ” ë”°ë¡œ ë©”ì„œë“œë¥¼ ìƒì„±í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ì‹¤ì œ ì„œë¹„ìŠ¤ë¥¼ ìš´ì˜í•  ë•ŒëŠ” ê°’ì„ ```set```í•  ìˆ˜ ìˆëŠ” ê³³ì´ ë„ˆë¬´ ë§ìœ¼ë©´ ìœ ì§€ë³´ìˆ˜ì— ì–´ë ¤ì›€ì„ ê²ªì„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

**ì§€ì—°ì „ëµì„ ì‚¬ìš©í•˜ê¸°**  
ëª¨ë“  ì—°ê´€ê´€ê³„ëŠ” ì§€ì—°ë¡œë”©ìœ¼ë¡œ ì„¤ì •í•´ì„œ í•œ ë²ˆ ì¡°íšŒì— ì—°ê´€ëœ í…Œì´ë¸”ë“¤ì´ ëª¨ë‘ ì¡°íšŒë¼ì„œ ë©”ëª¨ë¦¬ì— ë¡œë“œë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ ê²½ìš° ì„±ëŠ¥ì˜ ì €í•˜, ë¶ˆí•„ìš”í•œ ë°ì´í„° ì¿¼ë¦¬ê¹Œì§€ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ```@ManyToOne``` ë˜ëŠ” ```@OneToOne```ì—ì„œëŠ” ì¦‰ì‹œë¡œë”©ì´ ê¸°ë³¸ê°’ì´ë¯€ë¡œ ë°˜ë“œì‹œ ```fetch``` ì „ëµì„ ì§€ì—°ë¡œë”©ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.  
ë§Œì•½ì— ì¦‰ì‹œë¡œë”©ì¼ í•„ìš”í•œ ë¡œì§ì´ ìƒê¸°ëŠ” ê²½ìš° fetch ì¡°ì¸ì„ ì´ìš©í•˜ê±°ë‚˜ ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ì„ ì‚¬ìš©í•´ì„œ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ ì°¸ì¡°)

**ì»¬ë ‰ì…˜ì—ì„œ í•„ë“œ ì´ˆê¸°í™”**  
entity ì„¤ì •ì‹œ ì—°ê´€ê´€ê³„ ë§¤í•‘ìœ¼ë¡œ NPE ë°©ì§€ ì°¨ì›ì—ì„œ ì•„ë˜ ì½”ë“œì²˜ëŸ¼ ì´ˆê¸°í™”í•œ ì†ì„±ë“¤ì´ ìˆìŠµë‹ˆë‹¤. NPE ì™¸ì—ë„ í•˜ì´ë²„ë„¤ì´íŠ¸ì—ì„œ ì œê³µí•˜ëŠ” ë‚´ì¥ ì»¬ë ‰ì…˜ìœ¼ë¡œ ê´€ë¦¬ê°€ ë“¤ì–´ê°€ê¸° ë•Œë¬¸ì— ì„ì˜ë¡œ ë³€ê²½í•˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.
```java
@OneToMany(mappedBy = "member")
private List<Orders> orders = new ArrayList<>();
```

<span style="background-color:#DCFFE4">í•˜ì´ë²„ë„¤ì´íŠ¸ì—ì„œ ì»¬ë ‰ì…˜ì„ ì–´ë–»ê²Œ ê´€ë¦¬ë¥¼ í•œë‹¤ëŠ” ë§ì¸ê°€</span>  
ê°•ì˜ë§Œ ë“£ê³ ëŠ” ì´í•´ê°€ ê°€ì§€ ì•Šì•˜ëŠ”ë°, ì €ì™€ ê°™ì€ ê³ ë¯¼ì„ í•œ ê¸€ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. í•˜ì´ë²„ë„¤ì´íŠ¸ê°€ ì—”í‹°í‹°ë¥¼ ì˜ì†í™”í•  ë•Œ ë‚´ë¶€ì— ì»¬ë ‰ì…˜ì´ ìˆìœ¼ë©´ í•˜ì´ë²„ë„¤ì´íŠ¸ê°€ íŠ¹ë³„í•˜ê²Œ ì¡°ì‘í•œ ì»¬ë ‰ì…˜ìœ¼ë¡œ ë³€ê²½í•œë‹¤ê³  í•©ë‹ˆë‹¤. ê·¸ë˜ì„œ ì„ì˜ ìˆ˜ì •ì‹œ í•˜ì´ë²„ë„¤ì´íŠ¸ê°€ ì¸ì‹ì„ í•˜ì§€ ëª»í•´ ì œëŒ€ë¡œ ë™ì‘í•  ìˆ˜ ì—†ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤ê³  í•©ë‹ˆë‹¤.  
ê·¸ëŸ¼ í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” ì»¬ë ‰ì…˜ì„ ì–´ë–»ê²Œ ê´€ë¦¬í•˜ëŠ” ê±¸ê¹Œìš”?  
í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” ì»¬ë ‰ì…˜ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ì—”í‹°í‹°ë¥¼ ì˜ì† ìƒíƒœë¡œ ë§Œë“¤ë•Œ ì›ë³¸ ì»¬ë ‰ì…˜ì„ ê°ì‹¸ê³  ìˆëŠ” ë‚´ì¥ ì»¬ë ‰ì…˜ì„ ìƒì„±í•´ì„œ ë‚´ì¥ ì»¬ë ‰ì…˜ì„ ì‚¬ìš©í•˜ë„ë¡ ì°¸ì¡°ë¥¼ ë³€ê²½í•©ë‹ˆë‹¤. ```PersistentBag```, ```PersistentList```, ```PersistentSet``` ë“±ì˜ ì»¬ë ‰ì…˜ ë˜í¼ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì»¬ë ‰ì…˜ë“¤ì€ ì¼ë°˜ì ì¸ ìë°” ì»¬ë ‰ì…˜ê³¼ ë‹¬ë¦¬ ë°ì´í„°ë² ì´ìŠ¤ì™€ì˜ ì—°ë™ì„ ìœ„í•œ ì¶”ê°€ì ì¸ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ```PersistentBag```ì€ ì¤‘ë³µëœ ê°’ì„ í—ˆìš©í•˜ë©´ì„œë„ ìˆœì„œë¥¼ ìœ ì§€í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ```PersistentBag```ì€ ë°ì´í„°ë² ì´ìŠ¤ì™€ì˜ ë™ê¸°í™”ë¥¼ ìœ„í•´ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ í•„ìš”í•œ ë°ì´í„°ë§Œ ë¡œë”©í•˜ì—¬ ë©”ëª¨ë¦¬ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ìµœì í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

**ë³€ê²½ê°ì§€**  
ë³€ê²½ê°ì§€ë¥¼ ì´ìš©í•˜ë©´, ```find()```ë¡œ entityë¥¼ ê°€ì ¸ì˜¤ëŠ” ê³¼ì •ì—ì„œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê´€ë¦¬ëŒ€ìƒì´ ë˜ê¸° ë•Œë¬¸ì— ë³„ë„ì˜ ```save()``` ë¡œì§ì´ ì—†ì–´ë„ íŠ¸ëœì­ì…˜ì´ ëë‚˜ëŠ” ì‹œì ì— ```Dirty Checking```ì„ ì§„í–‰í•©ë‹ˆë‹¤.
```java
private final EntityManager em;
Member m = em.find(Member.class, 1);
m.setName("John");
m.setAge(30);
```
```merge()```ë¡œ ë³‘í•©ì²˜ë¦¬ë¥¼ í•˜ëŠ” ê²½ìš°ì—ëŠ” ê¸°ì¡´ ê°’ì—ì„œ ë³€ê²½ëœ ê°’ì´ ìˆì„ ë•Œ, êµ¬ë¶„í•´ì„œ ë“¤ì–´ê°€ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ëª¨ë‘ ë³‘í•©ì²˜ë¦¬ë˜ì–´ ```null```ë¡œ ë°›ëŠ” ê°’ì´ ìˆëŠ” ê²½ìš° ```null``` ì²˜ë¦¬ë˜ê¸° ë•Œë¬¸ì— ì‚¬ìš©ì— ìœ ì˜í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

**ê°ì²´ì§€í–¥ ì„¤ê³„ë¥¼ ìœ„í•œ ì—”í‹°í‹° ì—°ê´€ ë©”ì„œë“œ ì‘ì„±**  
ì—”í‹°í‹°ì™€ ì—°ê´€ëœ ë©”ì„œë“œëŠ” ê´€ë¦¬ë¥¼ ìœ„í•´ ì—”í‹°í‹°ì™€ ê°™ì´ ì‘ì„±í•´ë‘¡ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì—”í‹°í‹°ì˜ ìƒì„±, ì‚­ì œ, ì—”í‹°í‹°ì˜ ì†ì„±ë§Œì„ ê°€ì§€ê³  ê³„ì‚°í•˜ëŠ” ë©”ì„œë“œ ë“±ì´ í•´ë‹¹ë©ë‹ˆë‹¤. ì´ëŠ” ê°ì²´ì§€í–¥ ì„¤ê³„ ê´€ì ì—ì„œë„ í•„ìš”í•˜ê³ , ë¶ˆí•„ìš”í•œ ì—”í‹°í‹° ì¡°ì‘ì„ ë°©ì§€í•˜ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ```Member```ë¼ëŠ” ê°ì²´ ìì²´ë¥¼ ì™¸ë¶€ì—ì„œ ë§‰ ìˆ˜ì •í•  ìˆ˜ ì—†ë„ë¡ ìƒì„±ìë¥¼ ```protect```ì²˜ë¦¬í•˜ê³  ìƒì„± ë©”ì„œë“œë¥¼ ì§ì ‘ ì‘ì„±í•˜ëŠ” ê²ƒë“¤ì´ í•´ë‹¹ë©ë‹ˆë‹¤.
```java
protected Stock(){}

public void addStock(int quantity){
    this.stockQuantity += quantity;
}

public void removeStock(int quantity){
    int restStock = this.stockQuantity -= quantity;
    if(restStock<0){
        throw new NotEnoughStockException("need more stock");
    }
    this.stockQuantity = restStock;
}
```

****
[ì‹¤ì „! ìŠ¤í”„ë§ ë¶€íŠ¸ì™€ JPA í™œìš©1 - ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8-JPA-%ED%99%9C%EC%9A%A9-1)  
[ì‹¤ì „! ìŠ¤í”„ë§ ë¶€íŠ¸ì™€ JPA í™œìš©2 - API ê°œë°œê³¼ ì„±ëŠ¥ ìµœì í™”](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8-JPA-API%EA%B0%9C%EB%B0%9C-%EC%84%B1%EB%8A%A5%EC%B5%9C%EC%A0%81%ED%99%94)  
[í•„ë“œì— ìˆëŠ” ì»¬ë ‰ì…˜ì„ ì´ˆê¸°í™” ì‹œí‚¤ëŠ” ì´ìœ ê°€ ë­”ê°€ìš”?](https://www.inflearn.com/questions/258175/%ED%95%84%EB%93%9C%EC%97%90-%EC%9E%88%EB%8A%94-%EC%BB%AC%EB%A0%89%EC%85%98%EC%9D%84-%EC%B4%88%EA%B8%B0%ED%99%94-%EC%8B%9C%ED%82%A4%EB%8A%94-%EC%9D%B4%EC%9C%A0%EA%B0%80-%EB%AD%94%EA%B0%80%EC%9A%94)  
[PersistentBag](https://docs.jboss.org/hibernate/orm/3.5/javadocs/org/hibernate/collection/PersistentBag.html)

<br><br>

## @Transactional
íŠ¸ëœì­ì…˜ ê´€ë¦¬ë¥¼ ìœ„í•´ Spring Framework 2.0 ì´ìƒì˜ ë²„ì „ì—ì„œ ì§€ì›ë˜ëŠ” ì–´ë…¸í…Œì´ì…˜ì…ë‹ˆë‹¤. ë©”ì„œë“œ ë ˆë²¨ ë˜ëŠ” í´ë˜ìŠ¤ ë ˆë²¨ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, í•´ë‹¹ ë©”ì„œë“œ ë˜ëŠ” í´ë˜ìŠ¤ì˜ ëª¨ë“  public ë©”ì„œë“œì— íŠ¸ëœì­ì…˜ì„ ì ìš©í•©ë‹ˆë‹¤.

<br>

**@Transactionalì˜ ì‘ë™ë°©ì‹**  
<span style="background-color:#fff5b1">Spring boot ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ëŠ” ì‹œì </span>ì— proxy ë¥¼ ìƒì„±ì— í•„ìš”í•œ TransactionAutoConfiguration ë“± í´ë˜ìŠ¤ë“¤ì´ ìë™ìœ¼ë¡œ í™œì„±í™”ë©ë‹ˆë‹¤. ë”°ë¼ì„œ í´ë¼ì´ì–¸íŠ¸ requestë¥¼ ë³´ë‚´ë©´ @Transactionalì´ ì ìš©ëœ ë©”ì„œë“œì— ëŒ€í•œ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.
```java
@Configuration(proxyBeanMethods = false)
@ConditionalOnClass(PlatformTransactionManager.class)
@AutoConfigureAfter({ JtaAutoConfiguration.class, HibernateJpaAutoConfiguration.class,
  DataSourceTransactionManagerAutoConfiguration.class, Neo4jDataAutoConfiguration.class })
@EnableConfigurationProperties(TransactionProperties.class)
public class TransactionAutoConfiguration {

   @Configuration(proxyBeanMethods = false)
   @ConditionalOnBean(TransactionManager.class)
   @ConditionalOnMissingBean(AbstractTransactionManagementConfiguration.class)
   public static class EnableTransactionManagementConfiguration {

      @Configuration(proxyBeanMethods = false)
      @EnableTransactionManagement(proxyTargetClass = false)
      @ConditionalOnProperty(prefix = "spring.aop", name = "proxy-target-class", havingValue = "false")
      public static class JdkDynamicAutoProxyConfiguration {}

      @Configuration(proxyBeanMethods = false)
      @EnableTransactionManagement(proxyTargetClass = true)
      @ConditionalOnProperty(prefix = "spring.aop", name = "proxy-target-class", havingValue = "true",
        matchIfMissing = true)
      public static class CglibAutoProxyConfiguration {}

   }
}
```
ìœ„ ì½”ë“œì—ì„œ ì•Œ ìˆ˜ ìˆë“¯ì´ TransactionAutoConfigurationìœ¼ë¡œ ProxyConfiguration êµ¬ì„±ì„ í™œì„±í™”í•˜ê¸° ìœ„í•´ì„œëŠ” @ConditionalOnClassì— ë”°ë¥¸ ì„ í–‰ì¡°ê±´ìœ¼ë¡œ PlatformTransactionManager()ê°€ ìˆì–´ì•¼í•©ë‹ˆë‹¤.  
ì¼ë°˜ì ìœ¼ë¡œ ```spring-jdbc```ë‚˜ ```spring-data-jpa``` ë“±ì˜ ì˜ì¡´ì„±ì„ í¬í•¨ì‹œí‚¤ë©´DataSourceTransactionManageë‚˜ JpaTransactionManager ë“±ê³¼ ê°™ì€ í´ë˜ìŠ¤ê°€ PlatformTransactionManager êµ¬í˜„ì²´ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤. ì´ë ‡ê²Œ êµ¬ì„±ëœ TransactionManagerëŠ” connection ê°ì²´ë¥¼ ìƒì„±í•˜ê³ , íŠ¸ëœì­ì…˜ì˜ commit ë˜ëŠ” rollbackì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.  
ì´ë ‡ê²Œ TransactionManagerê°€ ì„ ì •ë˜ë©´ @EnableTransactionManagementê°€ ì„ ì–¸ëœ ProxyConfiguration í´ë˜ìŠ¤ë¥¼ í†µí•´ íŠ¸ëœì­ì…˜ ê´€ë¦¬ ê¸°ëŠ¥ì„ í™œì„±í™”í•©ë‹ˆë‹¤. ProxyConfiguration í´ë˜ìŠ¤ë¡œ ë‘ ê°€ì§€ë¥¼ ì œì‹œí•˜ê³  ìˆëŠ”ë° ë°”ë¡œ JDK Dynamic Proxyì™€ CGLIB ë°©ì‹ì…ë‹ˆë‹¤. JDK Dynamic ProxyëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•˜ë©°, CGLIBì€ ë°”ì´íŠ¸ ì½”ë“œ ì¡°ì‘ì„ í†µí•´ ì›ë³¸ ê°ì²´ì˜ ì„œë¸Œí´ë˜ìŠ¤ë¥¼ ìƒì„±í•œë‹¤ëŠ” ì°¨ì´ì ì´ ìˆìŠµë‹ˆë‹¤.  
Springì€ AOP í”„ë ˆì„ì›Œí¬ë¥¼ ì´ìš©í•˜ì—¬ í”„ë¡ì‹œë¥¼ ìƒì„±í•˜ê³ , íŠ¹ì • ë©”ì†Œë“œ í˜¸ì¶œì„ ê°€ë¡œì±„ì„œ ì¶”ê°€ ë™ì‘ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

<br>

**@Transactionalì˜ ì†ì„±**
+ propagation(ì „íŒŒë°©ì‹)
  + REQUIRED, REQUIRES_NEW, NESTED, SUPPORTS, MANDATORY, NOT_SUPPORTED, NEVER
+ isolation(ê²©ë¦¬ìˆ˜ì¤€)
  + READ_UNCOMMITTED, READ_COMMITTED, REPEATABLE_READ, SERIALIZABLE
+ readonly(ì½ê¸° ì „ìš© ì—¬ë¶€)
+ timeout

<br>

**ì‚¬ìš©í•  ë•Œ ì´ê²ƒë§Œí¼ì€ ê³ ë ¤í•˜ì!**

<span style="background-color:#fff5b1">1. íŠ¸ëœì­ì…˜ì„ ì ìš©í•˜ë ¤ëŠ” ë©”ì„œë“œëŠ” ë°˜ë“œì‹œ publicìœ¼ë¡œ ì„ ì–¸ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</span>  
í”„ë¡ì‹œ ê°ì²´ë¡œ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•´ì•¼ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë§Œì•½ í•´ë‹¹ ë©”ì„œë“œê°€ privateì´ë‚˜ protectedë¡œ ì„ ì–¸ë˜ì–´ ìˆë‹¤ë©´, í”„ë¡ì‹œ ê°ì²´ê°€ ìƒì„±ë  ë•Œ í•´ë‹¹ ë©”ì„œë“œì— ì ‘ê·¼í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ @Transactional ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•œ íŠ¸ëœì­ì…˜ ê´€ë¦¬ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.

<span style="background-color:#fff5b1">2. ë‹¤ë¥¸ AOP ê¸°ëŠ¥ê³¼ì˜ ì¶©ëŒì„ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤.</span>
ì˜ˆë¥¼ ë“¤ì–´ @Securedë¥¼ í†µí•´ ê¶Œí•œì´ ìˆëŠ” ì‚¬ìš©ì ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ”ë° @Transactionalì´ ë¨¼ì € ìˆ˜í–‰ëœë‹¤ë©´ ê¶Œí•œ ê²€ì‚¬ê°€ ë¬´ì˜ë¯¸í•´ì§‘ë‹ˆë‹¤.  
ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œëŠ” @Orderë¥¼ ì´ìš©í•´ ì ìš© ìˆœì„œë¥¼ ì •í•˜ê±°ë‚˜ ì ìš©ë²”ìœ„ë¥¼ ì¡°ì •í•´ì„œ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì™¸ì—ë„ @Transactional proxyTargetClass ì†ì„±ì„ trueë¡œ ì„¤ì •í•˜ì—¬ ê°•ì œë¡œ í´ë˜ìŠ¤ë¥¼ ëŒ€ìƒìœ¼ë¡œ í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì§€ì •í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì„±ëŠ¥ì €í•˜ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤ëŠ” ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤.

<span style="background-color:#fff5b1">3. Service ê³„ì¸µì—ì„œ ì‚¬ìš©í•˜ì.</span>  
Service ê³„ì¸µì—ì„œ @Transactionalì„ ì‚¬ìš©í•˜ë¯€ë¡œì¨ ì—¬ëŸ¬ ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ë“¤ì„ ì›ìì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  Springì—ì„œ ë‹¨ì¼ ì±…ì„ì›ì¹™ì— ë”°ë¼ Database ê³„ì¸µì—ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ê´€ë ¨ ì—†ëŠ” ì—­í• ì„ ë‹´ë‹¹í•´ ì½”ë“œì˜ ìœ ì§€ë³´ìˆ˜ì™€ í™•ì¥ì„±ì´ ë†’ì´ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.  
<span style="background-color:#DCFFE4">ê·¸ëŸ¼ JPAì—ì„œëŠ” ì™œ SimpleJpaRepositoryì— @Transactionalì„ ì‚¬ìš©í• ê¹Œìš”?</span>  
Spring Data JPAì—ì„œ ì œê³µí•˜ëŠ” SimpleJpaRepositoryëŠ” ì¼ë°˜ì ì¸ ë ˆí¬ì§€í† ë¦¬ êµ¬í˜„ì²´ì™€ëŠ” ì¡°ê¸ˆ ë‹¤ë¦…ë‹ˆë‹¤. SimpleJpaRepositoryëŠ” JPAì—ì„œ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ë“¤ì„ í™œìš©í•˜ì—¬, ì¼ë¶€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ë©´, save() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì—”í‹°í‹°ë¥¼ ì €ì¥í•  ë•Œ ìƒˆë¡œìš´ ê²ƒì¸ì§€ ì•„ë‹ˆë©´ ì´ë¯¸ ì €ì¥ëœ ê²ƒì¸ì§€ë¥¼ íŒë‹¨í•˜ì—¬ ë™ì‘ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  Mixed Transactionì´ ë°œìƒí•´ë„ ì¼ë°˜ì ìœ¼ë¡œ Service ê³„ì¸µì˜ @Transactionalì´ ìš°ì„ ìˆœìœ„ë¥¼ ê°–ìŠµë‹ˆë‹¤.

<span style="background-color:#fff5b1">4. Exceptionì„ ê³ ë ¤í•˜ì.</span>  
íŠ¸ëœì­ì…˜ì€ RuntimeExceptionê³¼ Errorì—ì„œëŠ” ë¡¤ë°±ë˜ì§€ë§Œ, Checked exceptionsì—ì„œëŠ” ë¡¤ë°±ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Checked exceptionsëŠ” ì˜ˆì¸¡ê°€ëŠ¥í•œ ì—ëŸ¬ë¥¼ ë§í•˜ëŠ”ë°, ì•„ë˜ì™€ ê°™ì´ @Transactionalì— rollbackFor ì†ì„±ì„ ë‘ì–´ ë¡¤ë°±ì²˜ë¦¬ê°€ ë˜ë„ë¡ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
```java
@Transactional(rollbackFor={Exception.class})
```
<span style="background-color:#fff5b1">5. íŠ¸ëœì­ì…˜ Checked exceptionì´ ë°œìƒí–ˆì„ ë•Œ Javaì™€ Kotlin</span>  
Javaì—ì„œëŠ” ë¡¤ë°±ë˜ì§€ ì•Šê³  Checked exceptionì„ try-catch, throw ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ìˆì§€ë§Œ Kotlinì—ì„œëŠ” íŠ¸ëœì­ì…˜ì´ ë¡¤ë°±ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ Javaì—ì„œì²˜ëŸ¼ ë¡¤ë°±ì´ ë˜ì§€ ì•Šë„ë¡ @Throwsë¥¼ ì‚¬ìš©í•´ì„œ ì²˜ë¦¬í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
ë”°ë¼ì„œ ê°œë°œìëŠ” ì–´ë–¤ ì–¸ì–´ë¥¼ ìŠ¤í”„ë§ê³¼ ì‚¬ìš©í•˜ëŠ”ì§€ ê·¸ë¦¬ê³  Custom Exception ì„¤ì •ì„ ì–´ë–»ê²Œ í•˜ëŠ”ì§€ì— ë”°ë¼ ë‹¤ì–‘í•œ Exception ì²˜ë¦¬ë°©ë²•ì„ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤.

<span style="background-color:#fff5b1">6. íŠ¸ëœì­ì…˜ê³¼ DeadLock</span>  
ì‹¤ì œë¡œ DeadLock ì´ìŠˆê°€ ë°œìƒí•´ì„œ ë¦¬í™í† ë§ì„ í•˜ë©´ì„œ ê°€ì¥ ìœ ì‹¬íˆ ë³¸ ë¶€ë¶„ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. Service ê³„ì¸µì—ì„œ ì„¤ì •í•œ ë©”ì„œë“œë“¤ì´ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì–´ë–¤ ë°©í–¥ìœ¼ë¡œ ë¦¬ì†ŒìŠ¤ë¥¼ ì ìœ í•˜ëŠ”ì§€ëŠ” ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤.

****
[@Transactional ë°”ë¥´ê²Œ ì•Œê³  ì‚¬ìš©í•˜ê¸°](https://medium.com/gdgsongdo/transactional-%EB%B0%94%EB%A5%B4%EA%B2%8C-%EC%95%8C%EA%B3%A0-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0-7b0105eb5ed6)
[Spring Transaction Management: @Transactional In-Depth](https://www.marcobehler.com/guides/spring-transaction-management-transactional-in-depth)

<br><br>

## Lombok
**@ToString**  
í´ë˜ìŠ¤ì˜ toString ë©”ì„œë“œë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•´ì£¼ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤. ```@ToString(of={"ID", "NAME"}, includeFieldNames = false)```ì™€ ê°™ì´ ì»¬ëŸ¼ì„ ì§€ì •í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©ë˜ê¸°ë„ í•˜ê³ , ê° ì»¬ëŸ¼ ìœ„ì— ```@ToString.Include``` ë˜ëŠ” ```@ToString.Exclude```ë¥¼ ì‚¬ìš©í•´ì„œ ì»¬ëŸ¼ë³„ë¡œ ì§€ì •ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
```java
@Entity
@ToString(of={"ID, NAME"})
public class Person {
    long id;
    String name;
    int age;
}

// ë‹¤ë¥¸ ë°©ì‹ì˜ í™œìš©
@Entity
@ToString
public class Person {
  @ToString.Include  
  long id;
  @ToString.Include
  String name;
  @ToString.Exclude
  int age;
}
```
****
[Lombok ê¸°ë³¸ ì‚¬ìš©ë²• ìµíˆê¸°](https://advenoh.tistory.com/24)

<div style="padding:3px; margin:200px 0;"></div>   




